/** @constructor
*/
var Automaton = function(){
var True = true;
var False = false;

/*******************************************************************************
 * Thunks.
 */

// Force a thunk (if it is a thunk) until WHNF.
function _(thunkish,nocache){
  while (thunkish instanceof $) {
    thunkish = thunkish.force(nocache);
  }
  return thunkish;
}

// Apply a function to arguments (see method2 in Fay.hs).
function __(){
  var f = arguments[0];
  for (var i = 1, len = arguments.length; i < len; i++) {
    f = (f instanceof $? _(f) : f)(arguments[i]);
  }
  return f;
}

// Thunk object.
function $(value){
  this.forced = false;
  this.value = value;
}

// Force the thunk.
$.prototype.force = function(nocache) {
  return nocache ?
    this.value() :
    (this.forced ?
     this.value :
     (this.value = this.value(), this.forced = true, this.value));
};

function Fay$$seq(x) {
  return function(y) {
    _(x,false);
    return y;
  }
}

function Fay$$seq$36$uncurried(x,y) {
  _(x,false);
  return y;
}

/*******************************************************************************
 * Monad.
 */

function Fay$$Monad(value){
  this.value = value;
}

// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
// >>
function Fay$$then(a){
  return function(b){
    return Fay$$bind(a)(function(_){
      return b;
    });
  };
}

// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
// >>
function Fay$$then$36$uncurried(a,b){
  return Fay$$bind$36$uncurried(a,function(_){ return b; });
}

// >>=
// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
function Fay$$bind(m){
  return function(f){
    return new $(function(){
      var monad = _(m,true);
      return f(monad.value);
    });
  };
}

// >>=
// This is used directly from Fay, but can be rebound or shadowed. See primOps in Types.hs.
function Fay$$bind$36$uncurried(m,f){
    return new $(function(){
      var monad = _(m,true);
      return f(monad.value);
    });
}

// This is used directly from Fay, but can be rebound or shadowed.
function Fay$$$_return(a){
  return new Fay$$Monad(a);
}

// Allow the programmer to access thunk forcing directly.
function Fay$$force(thunk){
  return function(type){
    return new $(function(){
      _(thunk,type);
      return new Fay$$Monad(Fay$$unit);
    })
  }
}

// This is used directly from Fay, but can be rebound or shadowed.
function Fay$$return$36$uncurried(a){
  return new Fay$$Monad(a);
}

// Unit: ().
var Fay$$unit = null;

/*******************************************************************************
 * Serialization.
 * Fay <-> JS. Should be bijective.
 */

// Serialize a Fay object to JS.
function Fay$$fayToJs(type,fayObj){
  var base = type[0];
  var args = type[1];
  var jsObj;
  switch(base){
    case "action": {
      // A nullary monadic action. Should become a nullary JS function.
      // Fay () -> function(){ return ... }
      jsObj = function(){
        return Fay$$fayToJs(args[0],_(fayObj,true).value);
      };
      break;
    }
    case "function": {
      // A proper function.
      jsObj = function(){
        var fayFunc = fayObj;
        var return_type = args[args.length-1];
        var len = args.length;
        // If some arguments.
        if (len > 1) {
          // Apply to all the arguments.
          fayFunc = _(fayFunc,true);
          // TODO: Perhaps we should throw an error when JS
          // passes more arguments than Haskell accepts.
          for (var i = 0, len = len; i < len - 1 && fayFunc instanceof Function; i++) {
            // Unserialize the JS values to Fay for the Fay callback.
            fayFunc = _(fayFunc(Fay$$jsToFay(args[i],arguments[i])),true);
          }
          // Finally, serialize the Fay return value back to JS.
          var return_base = return_type[0];
          var return_args = return_type[1];
          // If it's a monadic return value, get the value instead.
          if(return_base == "action") {
            return Fay$$fayToJs(return_args[0],fayFunc.value);
          }
          // Otherwise just serialize the value direct.
          else {
            return Fay$$fayToJs(return_type,fayFunc);
          }
        } else {
          throw new Error("Nullary function?");
        }
      };
      break;
    }
    case "string": {
      // Serialize Fay string to JavaScript string.
      var str = "";
      fayObj = _(fayObj);
      while(fayObj instanceof Fay$$Cons) {
        str += fayObj.car;
        fayObj = _(fayObj.cdr);
      }
      jsObj = str;
      break;
    }
    case "list": {
      // Serialize Fay list to JavaScript array.
      var arr = [];
      fayObj = _(fayObj);
      while(fayObj instanceof Fay$$Cons) {
        arr.push(Fay$$fayToJs(args[0],fayObj.car));
        fayObj = _(fayObj.cdr);
      }
      jsObj = arr;
      break;
    }
    case "tuple": {
      // Serialize Fay tuple to JavaScript array.
      var arr = [];
      fayObj = _(fayObj);
      var i = 0;
      while(fayObj instanceof Fay$$Cons) {
        arr.push(Fay$$fayToJs(args[i++],fayObj.car));
        fayObj = _(fayObj.cdr);
      }
      jsObj = arr;
      break;
    }
    case "defined": {
      fayObj = _(fayObj);
      if (fayObj instanceof $_Language$Fay$Stdlib$Undefined) {
        jsObj = undefined;
      } else {
        jsObj = Fay$$fayToJs(args[0],fayObj["slot1"]);
      }
      break;
    }
    case "double": {
      // Serialize double, just force the argument. Doubles are unboxed.
      jsObj = _(fayObj);
      break;
    }
    case "int": {
      // Serialize int, just force the argument. Ints are unboxed.
      jsObj = _(fayObj);
      break;
    }
    case "bool": {
      // Bools are unboxed.
      jsObj = _(fayObj);
      break;
    }
    case "unknown":
    case "user": {
      if(fayObj instanceof $)
        fayObj = _(fayObj);
      jsObj = Fay$$fayToJsUserDefined(type,fayObj);
      break;
    }
    default: throw new Error("Unhandled Fay->JS translation type: " + base);
    }
    return jsObj;
}

// Unserialize an object from JS to Fay.
function Fay$$jsToFay(type,jsObj){
  var base = type[0];
  var args = type[1];
  var fayObj;
  switch(base){
    case "action": {
      // Unserialize a "monadic" JavaScript return value into a monadic value.
      fayObj = new Fay$$Monad(Fay$$jsToFay(args[0],jsObj));
      break;
    }
    case "string": {
      // Unserialize a JS string into Fay list (String).
      fayObj = Fay$$list(jsObj);
      break;
    }
    case "list": {
      // Unserialize a JS array into a Fay list ([a]).
      var serializedList = [];
      for (var i = 0, len = jsObj.length; i < len; i++) {
        // Unserialize each JS value into a Fay value, too.
        serializedList.push(Fay$$jsToFay(args[0],jsObj[i]));
      }
      // Pop it all in a Fay list.
      fayObj = Fay$$list(serializedList);
      break;
    }
    case "tuple": {
      // Unserialize a JS array into a Fay tuple ((a,b,c,...)).
      var serializedTuple = [];
      for (var i = 0, len = jsObj.length; i < len; i++) {
        // Unserialize each JS value into a Fay value, too.
        serializedTuple.push(Fay$$jsToFay(args[i],jsObj[i]));
      }
      // Pop it all in a Fay list.
      fayObj = Fay$$list(serializedTuple);
      break;
    }
    case "defined": {
      if (jsObj === undefined) {
        fayObj = new $_Language$Fay$Stdlib$Undefined();
      } else {
        fayObj = new $_Language$Fay$Stdlib$Defined(Fay$$jsToFay(args[0],jsObj));
      }
      break;
    }
    case "double": {
      // Doubles are unboxed, so there's nothing to do.
      fayObj = jsObj;
      break;
    }
    case "int": {
      // Int are unboxed, so there's no forcing to do.
      // But we can do validation that the int has no decimal places.
      // E.g. Math.round(x)!=x? throw "NOT AN INTEGER, GET OUT!"
      fayObj = Math.round(jsObj);
      if(fayObj!==jsObj) throw "Argument " + jsObj + " is not an integer!";
      break;
    }
    case "bool": {
      // Bools are unboxed.
      fayObj = jsObj;
      break;
    }
    case "unknown":
    case "user": {
      if (jsObj && jsObj['instance']) {
        fayObj = Fay$$jsToFayUserDefined(type,jsObj);
      }
      else
        fayObj = jsObj;
      break;
    }
  default: throw new Error("Unhandled JS->Fay translation type: " + base);
  }
  return fayObj;
}

/*******************************************************************************
 * Lists.
 */

// Cons object.
function Fay$$Cons(car,cdr){
  this.car = car;
  this.cdr = cdr;
}

// Make a list.
function Fay$$list(xs){
  var out = null;
  for(var i=xs.length-1; i>=0;i--)
    out = new Fay$$Cons(xs[i],out);
  return out;
}

// Built-in list cons.
function Fay$$cons(x){
  return function(y){
    return new Fay$$Cons(x,y);
  };
}

// List index.
function Fay$$index(index){
  return function(list){
    for(var i = 0; i < index; i++) {
      list = _(list).cdr;
    }
    return list.car;
  };
}

// List length.
function Fay$$listLen(list,max){
  for(var i = 0; list !== null && i < max + 1; i++) {
    list = _(list).cdr;
  }
  return i == max;
}

/*******************************************************************************
 * Numbers.
 */

// Built-in *.
function Fay$$mult(x){
  return function(y){
    return new $(function(){
      return _(x) * _(y);
    });
  };
}

function Fay$$mult$36$uncurried(x,y){

    return new $(function(){
      return _(x) * _(y);
    });

}

// Built-in +.
function Fay$$add(x){
  return function(y){
    return new $(function(){
      return _(x) + _(y);
    });
  };
}

// Built-in +.
function Fay$$add$36$uncurried(x,y){

    return new $(function(){
      return _(x) + _(y);
    });

}

// Built-in -.
function Fay$$sub(x){
  return function(y){
    return new $(function(){
      return _(x) - _(y);
    });
  };
}
// Built-in -.
function Fay$$sub$36$uncurried(x,y){

    return new $(function(){
      return _(x) - _(y);
    });

}

// Built-in /.
function Fay$$div(x){
  return function(y){
    return new $(function(){
      return _(x) / _(y);
    });
  };
}

// Built-in /.
function Fay$$div$36$uncurried(x,y){

    return new $(function(){
      return _(x) / _(y);
    });

}

/*******************************************************************************
 * Booleans.
 */

// Are two values equal?
function Fay$$equal(lit1, lit2) {
  // Simple case
  lit1 = _(lit1);
  lit2 = _(lit2);
  if (lit1 === lit2) {
    return true;
  }
  // General case
  if (lit1 instanceof Array) {
    if (lit1.length != lit2.length) return false;
    for (var len = lit1.length, i = 0; i < len; i++) {
      if (!Fay$$equal(lit1[i], lit2[i])) return false;
    }
    return true;
  } else if (lit1 instanceof Fay$$Cons && lit2 instanceof Fay$$Cons) {
    do {
      if (!Fay$$equal(lit1.car,lit2.car))
        return false;
      lit1 = _(lit1.cdr), lit2 = _(lit2.cdr);
      if (lit1 === null || lit2 === null)
        return lit1 === lit2;
    } while (true);
  } else if (typeof lit1 == 'object' && typeof lit2 == 'object' && lit1 && lit2 &&
             lit1.constructor === lit2.constructor) {
    for(var x in lit1) {
      if(!(lit1.hasOwnProperty(x) && lit2.hasOwnProperty(x) &&
           Fay$$equal(lit1[x],lit2[x])))
        return false;
    }
    return true;
  } else {
    return false;
  }
}

// Built-in ==.
function Fay$$eq(x){
  return function(y){
    return new $(function(){
      return Fay$$equal(x,y);
    });
  };
}

function Fay$$eq$36$uncurried(x,y){

    return new $(function(){
      return Fay$$equal(x,y);
    });

}

// Built-in /=.
function Fay$$neq(x){
  return function(y){
    return new $(function(){
      return !(Fay$$equal(x,y));
    });
  };
}

// Built-in /=.
function Fay$$neq$36$uncurried(x,y){

    return new $(function(){
      return !(Fay$$equal(x,y));
    });

}

// Built-in >.
function Fay$$gt(x){
  return function(y){
    return new $(function(){
      return _(x) > _(y);
    });
  };
}

// Built-in >.
function Fay$$gt$36$uncurried(x,y){

    return new $(function(){
      return _(x) > _(y);
    });

}

// Built-in <.
function Fay$$lt(x){
  return function(y){
    return new $(function(){
      return _(x) < _(y);
    });
  };
}


// Built-in <.
function Fay$$lt$36$uncurried(x,y){

    return new $(function(){
      return _(x) < _(y);
    });

}


// Built-in >=.
function Fay$$gte(x){
  return function(y){
    return new $(function(){
      return _(x) >= _(y);
    });
  };
}

// Built-in >=.
function Fay$$gte$36$uncurried(x,y){

    return new $(function(){
      return _(x) >= _(y);
    });

}

// Built-in <=.
function Fay$$lte(x){
  return function(y){
    return new $(function(){
      return _(x) <= _(y);
    });
  };
}

// Built-in <=.
function Fay$$lte$36$uncurried(x,y){

    return new $(function(){
      return _(x) <= _(y);
    });

}

// Built-in &&.
function Fay$$and(x){
  return function(y){
    return new $(function(){
      return _(x) && _(y);
    });
  };
}

// Built-in &&.
function Fay$$and$36$uncurried(x,y){

    return new $(function(){
      return _(x) && _(y);
    });
 ;
}

// Built-in ||.
function Fay$$or(x){
  return function(y){
    return new $(function(){
      return _(x) || _(y);
    });
  };
}

// Built-in ||.
function Fay$$or$36$uncurried(x,y){

    return new $(function(){
      return _(x) || _(y);
    });

}

/*******************************************************************************
 * Mutable references.
 */

// Make a new mutable reference.
function Fay$$Ref(x){
  this.value = x;
}

// Write to the ref.
function Fay$$writeRef(ref,x){
  ref.value = x;
}

// Get the value from the ref.
function Fay$$readRef(ref,x){
  return ref.value;
}

/*******************************************************************************
 * Dates.
 */
function Fay$$date(str){
  return window.Date.parse(str);
}

/*******************************************************************************
 * Application code.
 */

var Language$Fay$Stdlib$error = function($p1){return new $(function(){var str = $p1;return (function($tmp1){if (_($tmp1) === 0) {return _(Language$Fay$Stdlib$error)(str);}return _(Language$Fay$Stdlib$error)(str);})(_(Language$Fay$Stdlib$error$39$)(str));});};var Language$Fay$Stdlib$error$39$ = function($p1){return new $(function(){return Fay$$jsToFay(["int"],(function() { throw Fay$$fayToJs(["string"],$p1) })());});};var Language$Fay$Stdlib$$_undefined = new $(function(){return _(Language$Fay$Stdlib$error)(Fay$$list("Prelude.undefined"));});var Language$Fay$Stdlib$show = function($p1){return new $(function(){return Fay$$jsToFay(["string"],JSON.stringify(Fay$$fayToJs(["unknown"],$p1)));});};var $_Language$Fay$Stdlib$Undefined = function(){};var Language$Fay$Stdlib$Undefined = new $(function(){return new $_Language$Fay$Stdlib$Undefined();});var $_Language$Fay$Stdlib$Defined = function(slot1){this.slot1 = slot1;};var Language$Fay$Stdlib$Defined = function(slot1){return new $(function(){return new $_Language$Fay$Stdlib$Defined(slot1);});};var $_Language$Fay$Stdlib$Left = function(slot1){this.slot1 = slot1;};var Language$Fay$Stdlib$Left = function(slot1){return new $(function(){return new $_Language$Fay$Stdlib$Left(slot1);});};var $_Language$Fay$Stdlib$Right = function(slot1){this.slot1 = slot1;};var Language$Fay$Stdlib$Right = function(slot1){return new $(function(){return new $_Language$Fay$Stdlib$Right(slot1);});};var Language$Fay$Stdlib$either = function($p1){return function($p2){return function($p3){return new $(function(){if (_($p3) instanceof $_Language$Fay$Stdlib$Left) {var a = _($p3).slot1;var f = $p1;return _(f)(a);}if (_($p3) instanceof $_Language$Fay$Stdlib$Right) {var b = _($p3).slot1;var g = $p2;return _(g)(b);}throw ["unhandled case in either",[$p1,$p2,$p3]];});};};};var Language$Fay$Stdlib$fromInteger = function($p1){return new $(function(){var x = $p1;return x;});};var Language$Fay$Stdlib$fromRational = function($p1){return new $(function(){var x = $p1;return x;});};var Language$Fay$Stdlib$negate = function($p1){return new $(function(){var x = $p1;return (-(_(x)));});};var Language$Fay$Stdlib$abs = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$lt)(_(x))(0)) ? _(Language$Fay$Stdlib$negate)(x) : x;});};var Language$Fay$Stdlib$signum = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$gt)(_(x))(0)) ? 1 : _(_(_(Fay$$eq)(x))(0)) ? 0 : (-(1));});};var Language$Fay$Stdlib$pi = new $(function(){return Fay$$jsToFay(["double"],Math.PI);});var Language$Fay$Stdlib$exp = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.exp(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$sqrt = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.sqrt(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$log = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.log(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$$42$$42$ = new $(function(){return Language$Fay$Stdlib$unsafePow;});var Language$Fay$Stdlib$$94$$94$ = new $(function(){return Language$Fay$Stdlib$unsafePow;});var Language$Fay$Stdlib$unsafePow = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["unknown"],Math.pow(Fay$$fayToJs(["unknown"],$p1),Fay$$fayToJs(["unknown"],$p2)));});};};var Language$Fay$Stdlib$$94$ = function($p1){return function($p2){return new $(function(){var b = $p2;var a = $p1;if (_(_(Fay$$lt)(_(b))(0))) {return _(Language$Fay$Stdlib$error)(Fay$$list("(^): negative exponent"));} else {if (_(_(_(Fay$$eq)(b))(0))) {return 1;} else {if (_(_(Language$Fay$Stdlib$even)(b))) {return (function(){var x = new $(function(){return _(_(Language$Fay$Stdlib$$94$)(a))(_(_(Language$Fay$Stdlib$quot)(b))(2));});return _(Fay$$mult)(_(x))(_(x));})();}}}var b = $p2;var a = $p1;return _(Fay$$mult)(_(a))(_(_(_(Language$Fay$Stdlib$$94$)(a))(_(Fay$$sub)(_(b))(1))));});};};var Language$Fay$Stdlib$logBase = function($p1){return function($p2){return new $(function(){var x = $p2;var b = $p1;return _(Fay$$div)(_(_(Language$Fay$Stdlib$log)(x)))(_(_(Language$Fay$Stdlib$log)(b)));});};};var Language$Fay$Stdlib$sin = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.sin(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$tan = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.tan(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$cos = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.cos(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$asin = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.asin(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$atan = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.atan(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$acos = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Math.acos(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$sinh = function($p1){return new $(function(){var x = $p1;return _(Fay$$div)(_(_(Fay$$sub)(_(_(Language$Fay$Stdlib$exp)(x)))(_(_(Language$Fay$Stdlib$exp)((-(_(x))))))))(2);});};var Language$Fay$Stdlib$tanh = function($p1){return new $(function(){var x = $p1;return (function(){var a = new $(function(){return _(Language$Fay$Stdlib$exp)(x);});var b = new $(function(){return _(Language$Fay$Stdlib$exp)((-(_(x))));});return _(Fay$$div)(_(_(Fay$$sub)(_(a))(_(b))))(_(_(Fay$$add)(_(a))(_(b))));})();});};var Language$Fay$Stdlib$cosh = function($p1){return new $(function(){var x = $p1;return _(Fay$$div)(_(_(Fay$$add)(_(_(Language$Fay$Stdlib$exp)(x)))(_(_(Language$Fay$Stdlib$exp)((-(_(x))))))))(2);});};var Language$Fay$Stdlib$asinh = function($p1){return new $(function(){var x = $p1;return _(Language$Fay$Stdlib$log)(_(Fay$$add)(_(x))(_(_(Language$Fay$Stdlib$sqrt)(_(Fay$$add)(_(_(_(Language$Fay$Stdlib$$42$$42$)(x))(2)))(1)))));});};var Language$Fay$Stdlib$atanh = function($p1){return new $(function(){var x = $p1;return _(Fay$$div)(_(_(Language$Fay$Stdlib$log)(_(Fay$$div)(_(_(Fay$$add)(1)(_(x))))(_(_(Fay$$sub)(1)(_(x)))))))(2);});};var Language$Fay$Stdlib$acosh = function($p1){return new $(function(){var x = $p1;return _(Language$Fay$Stdlib$log)(_(Fay$$add)(_(x))(_(_(Language$Fay$Stdlib$sqrt)(_(Fay$$sub)(_(_(_(Language$Fay$Stdlib$$42$$42$)(x))(2)))(1)))));});};var Language$Fay$Stdlib$properFraction = function($p1){return new $(function(){var x = $p1;return (function(){var a = new $(function(){return _(Language$Fay$Stdlib$truncate)(x);});return Fay$$list([a,_(Fay$$sub)(_(x))(_(_(Language$Fay$Stdlib$fromIntegral)(a)))]);})();});};var Language$Fay$Stdlib$truncate = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$lt)(_(x))(0)) ? _(Language$Fay$Stdlib$ceiling)(x) : _(Language$Fay$Stdlib$floor)(x);});};var Language$Fay$Stdlib$round = function($p1){return new $(function(){return Fay$$jsToFay(["int"],Math.round(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$ceiling = function($p1){return new $(function(){return Fay$$jsToFay(["int"],Math.ceil(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$floor = function($p1){return new $(function(){return Fay$$jsToFay(["int"],Math.floor(Fay$$fayToJs(["double"],$p1)));});};var Language$Fay$Stdlib$subtract = new $(function(){return _(Language$Fay$Stdlib$flip)(Fay$$sub);});var Language$Fay$Stdlib$even = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$eq)(_(_(Language$Fay$Stdlib$rem)(x))(2)))(0);});};var Language$Fay$Stdlib$odd = function($p1){return new $(function(){var x = $p1;return _(Language$Fay$Stdlib$not)(_(Language$Fay$Stdlib$even)(x));});};var Language$Fay$Stdlib$gcd = function($p1){return function($p2){return new $(function(){var b = $p2;var a = $p1;return (function(){var go = function($p1){return function($p2){return new $(function(){if (_($p2) === 0) {var x = $p1;return x;}var y = $p2;var x = $p1;return _(_(go)(y))(_(_(Language$Fay$Stdlib$rem)(x))(y));});};};return _(_(go)(_(Language$Fay$Stdlib$abs)(a)))(_(Language$Fay$Stdlib$abs)(b));})();});};};var Language$Fay$Stdlib$lcm = function($p1){return function($p2){return new $(function(){if (_($p2) === 0) {return 0;}if (_($p1) === 0) {return 0;}var b = $p2;var a = $p1;return _(Language$Fay$Stdlib$abs)(_(Fay$$mult)(_(_(_(Language$Fay$Stdlib$quot)(a))(_(_(Language$Fay$Stdlib$gcd)(a))(b))))(_(b)));});};};var Language$Fay$Stdlib$curry = function($p1){return function($p2){return function($p3){return new $(function(){var y = $p3;var x = $p2;var f = $p1;return _(f)(Fay$$list([x,y]));});};};};var Language$Fay$Stdlib$uncurry = function($p1){return function($p2){return new $(function(){var p = $p2;var f = $p1;return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var x = Fay$$index(0)(_($tmp1));var y = Fay$$index(1)(_($tmp1));return _(_(f)(x))(y);}return (function(){ throw (["unhandled case",$tmp1]); })();})(p);});};};var Language$Fay$Stdlib$snd = function($p1){return new $(function(){if (Fay$$listLen(_($p1),2)) {var x = Fay$$index(1)(_($p1));return x;}throw ["unhandled case in snd",[$p1]];});};var Language$Fay$Stdlib$fst = function($p1){return new $(function(){if (Fay$$listLen(_($p1),2)) {var x = Fay$$index(0)(_($p1));return x;}throw ["unhandled case in fst",[$p1]];});};var Language$Fay$Stdlib$find = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(_(p)(x)) ? _(Language$Fay$Stdlib$Just)(x) : _(_(Language$Fay$Stdlib$find)(p))(xs);}if (_($p2) === null) {return Language$Fay$Stdlib$Nothing;}throw ["unhandled case in find",[$p1,$p2]];});};};var Language$Fay$Stdlib$filter = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(_(p)(x)) ? _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$filter)(p))(xs)) : _(_(Language$Fay$Stdlib$filter)(p))(xs);}if (_($p2) === null) {return null;}throw ["unhandled case in filter",[$p1,$p2]];});};};var Language$Fay$Stdlib$not = function($p1){return new $(function(){var p = $p1;return _(p) ? false : true;});};var Language$Fay$Stdlib$$_null = function($p1){return new $(function(){if (_($p1) === null) {return true;}return false;});};var Language$Fay$Stdlib$map = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var f = $p1;return _(_(Fay$$cons)(_(f)(x)))(_(_(Language$Fay$Stdlib$map)(f))(xs));}throw ["unhandled case in map",[$p1,$p2]];});};};var Language$Fay$Stdlib$nub = function($p1){return new $(function(){var ls = $p1;return _(_(Language$Fay$Stdlib$nub$39$)(ls))(null);});};var Language$Fay$Stdlib$nub$39$ = function($p1){return function($p2){return new $(function(){if (_($p1) === null) {return null;}var ls = $p2;var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;return _(_(_(Language$Fay$Stdlib$elem)(x))(ls)) ? _(_(Language$Fay$Stdlib$nub$39$)(xs))(ls) : _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$nub$39$)(xs))(_(_(Fay$$cons)(x))(ls)));}throw ["unhandled case in nub'",[$p1,$p2]];});};};var Language$Fay$Stdlib$elem = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var y = $tmp1.car;var ys = $tmp1.cdr;var x = $p1;return _(Fay$$or)(_(_(_(Fay$$eq)(x))(y)))(_(_(_(Language$Fay$Stdlib$elem)(x))(ys)));}if (_($p2) === null) {return false;}throw ["unhandled case in elem",[$p1,$p2]];});};};var Language$Fay$Stdlib$notElem = function($p1){return function($p2){return new $(function(){var ys = $p2;var x = $p1;return _(Language$Fay$Stdlib$not)(_(_(Language$Fay$Stdlib$elem)(x))(ys));});};};var $_Language$Fay$Stdlib$GT = function(){};var Language$Fay$Stdlib$GT = new $(function(){return new $_Language$Fay$Stdlib$GT();});var $_Language$Fay$Stdlib$LT = function(){};var Language$Fay$Stdlib$LT = new $(function(){return new $_Language$Fay$Stdlib$LT();});var $_Language$Fay$Stdlib$EQ = function(){};var Language$Fay$Stdlib$EQ = new $(function(){return new $_Language$Fay$Stdlib$EQ();});var Language$Fay$Stdlib$sort = new $(function(){return _(Language$Fay$Stdlib$sortBy)(Language$Fay$Stdlib$compare);});var Language$Fay$Stdlib$compare = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;return _(_(Fay$$gt)(_(x))(_(y))) ? Language$Fay$Stdlib$GT : _(_(Fay$$lt)(_(x))(_(y))) ? Language$Fay$Stdlib$LT : Language$Fay$Stdlib$EQ;});};};var Language$Fay$Stdlib$sortBy = function($p1){return new $(function(){var cmp = $p1;return _(_(Language$Fay$Stdlib$foldr)(_(Language$Fay$Stdlib$insertBy)(cmp)))(null);});};var Language$Fay$Stdlib$insertBy = function($p1){return function($p2){return function($p3){return new $(function(){if (_($p3) === null) {var x = $p2;return Fay$$list([x]);}var ys = $p3;var x = $p2;var cmp = $p1;return (function($tmp1){if (_($tmp1) === null) {return Fay$$list([x]);}var $tmp2 = _($tmp1);if ($tmp2 instanceof Fay$$Cons) {var y = $tmp2.car;var ys$39$ = $tmp2.cdr;return (function($tmp2){if (_($tmp2) instanceof $_Language$Fay$Stdlib$GT) {return _(_(Fay$$cons)(y))(_(_(_(Language$Fay$Stdlib$insertBy)(cmp))(x))(ys$39$));}return _(_(Fay$$cons)(x))(ys);})(_(_(cmp)(x))(y));}return (function(){ throw (["unhandled case",$tmp1]); })();})(ys);});};};};var Language$Fay$Stdlib$when = function($p1){return function($p2){return new $(function(){var m = $p2;var p = $p1;return _(p) ? _(_(Fay$$then)(m))(_(Fay$$$_return)(Fay$$unit)) : _(Fay$$$_return)(Fay$$unit);});};};var Language$Fay$Stdlib$succ = function($p1){return new $(function(){var x = $p1;return _(Fay$$add)(_(x))(1);});};var Language$Fay$Stdlib$pred = function($p1){return new $(function(){var x = $p1;return _(Fay$$sub)(_(x))(1);});};var Language$Fay$Stdlib$enumFrom = function($p1){return new $(function(){var i = $p1;return _(_(Fay$$cons)(i))(_(Language$Fay$Stdlib$enumFrom)(_(Fay$$add)(_(i))(1)));});};var Language$Fay$Stdlib$enumFromTo = function($p1){return function($p2){return new $(function(){var n = $p2;var i = $p1;return _(_(Fay$$gt)(_(i))(_(n))) ? null : _(_(Fay$$cons)(i))(_(_(Language$Fay$Stdlib$enumFromTo)(_(Fay$$add)(_(i))(1)))(n));});};};var Language$Fay$Stdlib$enumFromBy = function($p1){return function($p2){return new $(function(){var by = $p2;var fr = $p1;return _(_(Fay$$cons)(fr))(_(_(Language$Fay$Stdlib$enumFromBy)(_(Fay$$add)(_(fr))(_(by))))(by));});};};var Language$Fay$Stdlib$enumFromThen = function($p1){return function($p2){return new $(function(){var th = $p2;var fr = $p1;return _(_(Language$Fay$Stdlib$enumFromBy)(fr))(_(Fay$$sub)(_(th))(_(fr)));});};};var Language$Fay$Stdlib$enumFromByTo = function($p1){return function($p2){return function($p3){return new $(function(){var to = $p3;var by = $p2;var fr = $p1;return (function(){var neg = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$lt)(_(x))(_(to))) ? null : _(_(Fay$$cons)(x))(_(neg)(_(Fay$$add)(_(x))(_(by))));});};var pos = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$gt)(_(x))(_(to))) ? null : _(_(Fay$$cons)(x))(_(pos)(_(Fay$$add)(_(x))(_(by))));});};return _(_(Fay$$lt)(_(by))(0)) ? _(neg)(fr) : _(pos)(fr);})();});};};};var Language$Fay$Stdlib$enumFromThenTo = function($p1){return function($p2){return function($p3){return new $(function(){var to = $p3;var th = $p2;var fr = $p1;return _(_(_(Language$Fay$Stdlib$enumFromByTo)(fr))(_(Fay$$sub)(_(th))(_(fr))))(to);});};};};var Language$Fay$Stdlib$zipWith = function($p1){return function($p2){return function($p3){return new $(function(){var $tmp1 = _($p3);if ($tmp1 instanceof Fay$$Cons) {var b = $tmp1.car;var bs = $tmp1.cdr;var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var a = $tmp1.car;var as = $tmp1.cdr;var f = $p1;return _(_(Fay$$cons)(_(_(f)(a))(b)))(_(_(_(Language$Fay$Stdlib$zipWith)(f))(as))(bs));}}return null;});};};};var Language$Fay$Stdlib$zipWith3 = function($p1){return function($p2){return function($p3){return function($p4){return new $(function(){var $tmp1 = _($p4);if ($tmp1 instanceof Fay$$Cons) {var c = $tmp1.car;var cs = $tmp1.cdr;var $tmp1 = _($p3);if ($tmp1 instanceof Fay$$Cons) {var b = $tmp1.car;var bs = $tmp1.cdr;var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var a = $tmp1.car;var as = $tmp1.cdr;var f = $p1;return _(_(Fay$$cons)(_(_(_(f)(a))(b))(c)))(_(_(_(_(Language$Fay$Stdlib$zipWith3)(f))(as))(bs))(cs));}}}return null;});};};};};var Language$Fay$Stdlib$zip = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var b = $tmp1.car;var bs = $tmp1.cdr;var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var a = $tmp1.car;var as = $tmp1.cdr;return _(_(Fay$$cons)(Fay$$list([a,b])))(_(_(Language$Fay$Stdlib$zip)(as))(bs));}}return null;});};};var Language$Fay$Stdlib$zip3 = function($p1){return function($p2){return function($p3){return new $(function(){var $tmp1 = _($p3);if ($tmp1 instanceof Fay$$Cons) {var c = $tmp1.car;var cs = $tmp1.cdr;var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var b = $tmp1.car;var bs = $tmp1.cdr;var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var a = $tmp1.car;var as = $tmp1.cdr;return _(_(Fay$$cons)(Fay$$list([a,b,c])))(_(_(_(Language$Fay$Stdlib$zip3)(as))(bs))(cs));}}}return null;});};};};var Language$Fay$Stdlib$unzip = function($p1){return new $(function(){var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {if (Fay$$listLen(_($tmp1.car),2)) {var x = Fay$$index(0)(_($tmp1.car));var y = Fay$$index(1)(_($tmp1.car));var ps = $tmp1.cdr;return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var xs = Fay$$index(0)(_($tmp1));var ys = Fay$$index(1)(_($tmp1));return Fay$$list([_(_(Fay$$cons)(x))(xs),_(_(Fay$$cons)(y))(ys)]);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(Language$Fay$Stdlib$unzip)(ps));}}if (_($p1) === null) {return Fay$$list([null,null]);}throw ["unhandled case in unzip",[$p1]];});};var Language$Fay$Stdlib$unzip3 = function($p1){return new $(function(){var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {if (Fay$$listLen(_($tmp1.car),3)) {var x = Fay$$index(0)(_($tmp1.car));var y = Fay$$index(1)(_($tmp1.car));var z = Fay$$index(2)(_($tmp1.car));var ps = $tmp1.cdr;return (function($tmp1){if (Fay$$listLen(_($tmp1),3)) {var xs = Fay$$index(0)(_($tmp1));var ys = Fay$$index(1)(_($tmp1));var zs = Fay$$index(2)(_($tmp1));return Fay$$list([_(_(Fay$$cons)(x))(xs),_(_(Fay$$cons)(y))(ys),_(_(Fay$$cons)(z))(zs)]);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(Language$Fay$Stdlib$unzip3)(ps));}}if (_($p1) === null) {return Fay$$list([null,null,null]);}throw ["unhandled case in unzip3",[$p1]];});};var Language$Fay$Stdlib$lines = function($p1){return new $(function(){if (_($p1) === null) {return null;}var s = $p1;return (function(){var isLineBreak = function($p1){return new $(function(){var c = $p1;return _(Fay$$or)(_(_(_(Fay$$eq)(c))("\r")))(_(_(_(Fay$$eq)(c))("\n")));});};return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var a = Fay$$index(0)(_($tmp1));if (_(Fay$$index(1)(_($tmp1))) === null) {return Fay$$list([a]);}var a = Fay$$index(0)(_($tmp1));var $tmp2 = _(Fay$$index(1)(_($tmp1)));if ($tmp2 instanceof Fay$$Cons) {var cs = $tmp2.cdr;return _(_(Fay$$cons)(a))(_(Language$Fay$Stdlib$lines)(cs));}}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$$_break)(isLineBreak))(s));})();});};var Language$Fay$Stdlib$unlines = new $(function(){return _(Language$Fay$Stdlib$intercalate)(Fay$$list("\n"));});var Language$Fay$Stdlib$words = function($p1){return new $(function(){var str = $p1;return (function(){var words$39$ = function($p1){return new $(function(){if (_($p1) === null) {return null;}var s = $p1;return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var a = Fay$$index(0)(_($tmp1));var b = Fay$$index(1)(_($tmp1));return _(_(Fay$$cons)(a))(_(Language$Fay$Stdlib$words)(b));}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$$_break)(isSpace))(s));});};var isSpace = function($p1){return new $(function(){var c = $p1;return _(_(Language$Fay$Stdlib$elem)(c))(Fay$$list(" \t\r\n\u000c\u000b"));});};return _(words$39$)(_(_(Language$Fay$Stdlib$dropWhile)(isSpace))(str));})();});};var Language$Fay$Stdlib$unwords = new $(function(){return _(Language$Fay$Stdlib$intercalate)(Fay$$list(" "));});var Language$Fay$Stdlib$flip = function($p1){return function($p2){return function($p3){return new $(function(){var y = $p3;var x = $p2;var f = $p1;return _(_(f)(y))(x);});};};};var Language$Fay$Stdlib$maybe = function($p1){return function($p2){return function($p3){return new $(function(){if (_($p3) instanceof $_Language$Fay$Stdlib$Nothing) {var m = $p1;return m;}if (_($p3) instanceof $_Language$Fay$Stdlib$Just) {var x = _($p3).slot1;var f = $p2;return _(f)(x);}throw ["unhandled case in maybe",[$p1,$p2,$p3]];});};};};var Language$Fay$Stdlib$$46$ = function($p1){return function($p2){return function($p3){return new $(function(){var x = $p3;var g = $p2;var f = $p1;return _(f)(_(g)(x));});};};};var Language$Fay$Stdlib$$43$$43$ = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;return _(_(Language$Fay$Stdlib$conc)(x))(y);});};};var Language$Fay$Stdlib$$36$ = function($p1){return function($p2){return new $(function(){var x = $p2;var f = $p1;return _(f)(x);});};};var Language$Fay$Stdlib$conc = function($p1){return function($p2){return new $(function(){var ys = $p2;var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;return _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$conc)(xs))(ys));}var ys = $p2;if (_($p1) === null) {return ys;}throw ["unhandled case in conc",[$p1,$p2]];});};};var Language$Fay$Stdlib$concat = new $(function(){return _(_(Language$Fay$Stdlib$foldr)(Language$Fay$Stdlib$conc))(null);});var Language$Fay$Stdlib$concatMap = function($p1){return new $(function(){var f = $p1;return _(_(Language$Fay$Stdlib$foldr)(_(_(Language$Fay$Stdlib$$46$)(Language$Fay$Stdlib$$43$$43$))(f)))(null);});};var Language$Fay$Stdlib$foldr = function($p1){return function($p2){return function($p3){return new $(function(){if (_($p3) === null) {var z = $p2;return z;}var $tmp1 = _($p3);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var z = $p2;var f = $p1;return _(_(f)(x))(_(_(_(Language$Fay$Stdlib$foldr)(f))(z))(xs));}throw ["unhandled case in foldr",[$p1,$p2,$p3]];});};};};var Language$Fay$Stdlib$foldr1 = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),1)) {var x = Fay$$index(0)(_($p2));return x;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var f = $p1;return _(_(f)(x))(_(_(Language$Fay$Stdlib$foldr1)(f))(xs));}if (_($p2) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("foldr1: empty list"));}throw ["unhandled case in foldr1",[$p1,$p2]];});};};var Language$Fay$Stdlib$foldl = function($p1){return function($p2){return function($p3){return new $(function(){if (_($p3) === null) {var z = $p2;return z;}var $tmp1 = _($p3);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var z = $p2;var f = $p1;return _(_(_(Language$Fay$Stdlib$foldl)(f))(_(_(f)(z))(x)))(xs);}throw ["unhandled case in foldl",[$p1,$p2,$p3]];});};};};var Language$Fay$Stdlib$foldl1 = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var f = $p1;return _(_(_(Language$Fay$Stdlib$foldl)(f))(x))(xs);}if (_($p2) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("foldl1: empty list"));}throw ["unhandled case in foldl1",[$p1,$p2]];});};};var Language$Fay$Stdlib$and = function($p1){return new $(function(){if (_($p1) === null) {return true;}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;return _(Fay$$and)(_(x))(_(_(Language$Fay$Stdlib$and)(xs)));}throw ["unhandled case in and",[$p1]];});};var Language$Fay$Stdlib$or = function($p1){return new $(function(){if (_($p1) === null) {return false;}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;return _(Fay$$or)(_(x))(_(_(Language$Fay$Stdlib$or)(xs)));}throw ["unhandled case in or",[$p1]];});};var Language$Fay$Stdlib$any = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return false;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(Fay$$or)(_(_(p)(x)))(_(_(_(Language$Fay$Stdlib$any)(p))(xs)));}throw ["unhandled case in any",[$p1,$p2]];});};};var Language$Fay$Stdlib$all = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return true;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(Fay$$and)(_(_(p)(x)))(_(_(_(Language$Fay$Stdlib$all)(p))(xs)));}throw ["unhandled case in all",[$p1,$p2]];});};};var Language$Fay$Stdlib$maximum = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("maximum: empty list"));}var xs = $p1;return _(_(Language$Fay$Stdlib$foldl1)(Language$Fay$Stdlib$max))(xs);});};var Language$Fay$Stdlib$minimum = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("minimum: empty list"));}var xs = $p1;return _(_(Language$Fay$Stdlib$foldl1)(Language$Fay$Stdlib$min))(xs);});};var Language$Fay$Stdlib$product = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("product: empty list"));}var xs = $p1;return _(_(_(Language$Fay$Stdlib$foldl)(Fay$$mult))(1))(xs);});};var Language$Fay$Stdlib$sum = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("sum: empty list"));}var xs = $p1;return _(_(_(Language$Fay$Stdlib$foldl)(Fay$$add))(0))(xs);});};var Language$Fay$Stdlib$scanl = function($p1){return function($p2){return function($p3){return new $(function(){var l = $p3;var z = $p2;var f = $p1;return _(_(Fay$$cons)(z))((function($tmp1){if (_($tmp1) === null) {return null;}var $tmp2 = _($tmp1);if ($tmp2 instanceof Fay$$Cons) {var x = $tmp2.car;var xs = $tmp2.cdr;return _(_(_(Language$Fay$Stdlib$scanl)(f))(_(_(f)(z))(x)))(xs);}return (function(){ throw (["unhandled case",$tmp1]); })();})(l));});};};};var Language$Fay$Stdlib$scanl1 = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var f = $p1;return _(_(_(Language$Fay$Stdlib$scanl)(f))(x))(xs);}throw ["unhandled case in scanl1",[$p1,$p2]];});};};var Language$Fay$Stdlib$scanr = function($p1){return function($p2){return function($p3){return new $(function(){if (_($p3) === null) {var z = $p2;return Fay$$list([z]);}var $tmp1 = _($p3);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var z = $p2;var f = $p1;return (function($tmp1){var $tmp2 = _($tmp1);if ($tmp2 instanceof Fay$$Cons) {var h = $tmp2.car;var t = $tmp2.cdr;return _(_(Fay$$cons)(_(_(f)(x))(h)))(_(_(Fay$$cons)(h))(t));}return Language$Fay$Stdlib$$_undefined;})(_(_(_(Language$Fay$Stdlib$scanr)(f))(z))(xs));}throw ["unhandled case in scanr",[$p1,$p2,$p3]];});};};};var Language$Fay$Stdlib$scanr1 = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}if (Fay$$listLen(_($p2),1)) {var x = Fay$$index(0)(_($p2));return Fay$$list([x]);}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var f = $p1;return (function($tmp1){var $tmp2 = _($tmp1);if ($tmp2 instanceof Fay$$Cons) {var h = $tmp2.car;var t = $tmp2.cdr;return _(_(Fay$$cons)(_(_(f)(x))(h)))(_(_(Fay$$cons)(h))(t));}return Language$Fay$Stdlib$$_undefined;})(_(_(Language$Fay$Stdlib$scanr1)(f))(xs));}throw ["unhandled case in scanr1",[$p1,$p2]];});};};var Language$Fay$Stdlib$lookup = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {var _key = $p1;return Language$Fay$Stdlib$Nothing;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {if (Fay$$listLen(_($tmp1.car),2)) {var x = Fay$$index(0)(_($tmp1.car));var y = Fay$$index(1)(_($tmp1.car));var xys = $tmp1.cdr;var key = $p1;return _(_(_(Fay$$eq)(key))(x)) ? _(Language$Fay$Stdlib$Just)(y) : _(_(Language$Fay$Stdlib$lookup)(key))(xys);}}throw ["unhandled case in lookup",[$p1,$p2]];});};};var Language$Fay$Stdlib$intersperse = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var sep = $p1;return _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$prependToAll)(sep))(xs));}throw ["unhandled case in intersperse",[$p1,$p2]];});};};var Language$Fay$Stdlib$prependToAll = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var sep = $p1;return _(_(Fay$$cons)(sep))(_(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$prependToAll)(sep))(xs)));}throw ["unhandled case in prependToAll",[$p1,$p2]];});};};var Language$Fay$Stdlib$intercalate = function($p1){return function($p2){return new $(function(){var xss = $p2;var xs = $p1;return _(Language$Fay$Stdlib$concat)(_(_(Language$Fay$Stdlib$intersperse)(xs))(xss));});};};var Language$Fay$Stdlib$forM_ = function($p1){return function($p2){return new $(function(){var m = $p2;var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;return _(_(Fay$$then)(_(m)(x)))(_(_(Language$Fay$Stdlib$forM_)(xs))(m));}if (_($p1) === null) {return _(Fay$$$_return)(Fay$$unit);}throw ["unhandled case in forM_",[$p1,$p2]];});};};var Language$Fay$Stdlib$mapM_ = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var m = $p1;return _(_(Fay$$then)(_(m)(x)))(_(_(Language$Fay$Stdlib$mapM_)(m))(xs));}if (_($p2) === null) {return _(Fay$$$_return)(Fay$$unit);}throw ["unhandled case in mapM_",[$p1,$p2]];});};};var Language$Fay$Stdlib$$_const = function($p1){return function($p2){return new $(function(){var a = $p1;return a;});};};var Language$Fay$Stdlib$length = function($p1){return new $(function(){var xs = $p1;return _(_(Language$Fay$Stdlib$length$39$)(0))(xs);});};var Language$Fay$Stdlib$length$39$ = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var xs = $tmp1.cdr;var acc = $p1;return _(_(Language$Fay$Stdlib$length$39$)(_(Fay$$add)(_(acc))(1)))(xs);}var acc = $p1;return acc;});};};var Language$Fay$Stdlib$rem = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;return _(_(_(Fay$$eq)(y))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("Division by zero")) : _(_(Language$Fay$Stdlib$rem$39$)(x))(y);});};};var Language$Fay$Stdlib$rem$39$ = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["int"],Fay$$fayToJs(["int"],$p1) % Fay$$fayToJs(["int"],$p2));});};};var Language$Fay$Stdlib$quot = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;return _(_(_(Fay$$eq)(y))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("Division by zero")) : _(_(Language$Fay$Stdlib$quot$39$)(x))(y);});};};var Language$Fay$Stdlib$quot$39$ = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["int"],~~(Fay$$fayToJs(["int"],$p1)/Fay$$fayToJs(["int"],$p2)));});};};var Language$Fay$Stdlib$quotRem = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;return Fay$$list([_(_(Language$Fay$Stdlib$quot)(x))(y),_(_(Language$Fay$Stdlib$rem)(x))(y)]);});};};var Language$Fay$Stdlib$div = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;if (_(_(Fay$$and)(_(_(Fay$$gt)(_(x))(0)))(_(_(Fay$$lt)(_(y))(0))))) {return _(Fay$$sub)(_(_(_(Language$Fay$Stdlib$quot)(_(Fay$$sub)(_(x))(1)))(y)))(1);} else {if (_(_(Fay$$and)(_(_(Fay$$lt)(_(x))(0)))(_(_(Fay$$gt)(_(y))(0))))) {return _(Fay$$sub)(_(_(_(Language$Fay$Stdlib$quot)(_(Fay$$add)(_(x))(1)))(y)))(1);}}var y = $p2;var x = $p1;return _(_(Language$Fay$Stdlib$quot)(x))(y);});};};var Language$Fay$Stdlib$mod = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;if (_(_(Fay$$and)(_(_(Fay$$gt)(_(x))(0)))(_(_(Fay$$lt)(_(y))(0))))) {return _(Fay$$add)(_(_(Fay$$add)(_(_(_(Language$Fay$Stdlib$rem)(_(Fay$$sub)(_(x))(1)))(y)))(_(y))))(1);} else {if (_(_(Fay$$and)(_(_(Fay$$lt)(_(x))(0)))(_(_(Fay$$gt)(_(y))(0))))) {return _(Fay$$sub)(_(_(Fay$$add)(_(_(_(Language$Fay$Stdlib$rem)(_(Fay$$add)(_(x))(1)))(y)))(_(y))))(1);}}var y = $p2;var x = $p1;return _(_(Language$Fay$Stdlib$rem)(x))(y);});};};var Language$Fay$Stdlib$divMod = function($p1){return function($p2){return new $(function(){var y = $p2;var x = $p1;if (_(_(Fay$$and)(_(_(Fay$$gt)(_(x))(0)))(_(_(Fay$$lt)(_(y))(0))))) {return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var q = Fay$$index(0)(_($tmp1));var r = Fay$$index(1)(_($tmp1));return Fay$$list([_(Fay$$sub)(_(q))(1),_(Fay$$add)(_(_(Fay$$add)(_(r))(_(y))))(1)]);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$quotRem)(_(Fay$$sub)(_(x))(1)))(y));} else {if (_(_(Fay$$and)(_(_(Fay$$lt)(_(x))(0)))(_(_(Fay$$gt)(_(y))(1))))) {return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var q = Fay$$index(0)(_($tmp1));var r = Fay$$index(1)(_($tmp1));return Fay$$list([_(Fay$$sub)(_(q))(1),_(Fay$$sub)(_(_(Fay$$add)(_(r))(_(y))))(1)]);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$quotRem)(_(Fay$$add)(_(x))(1)))(y));}}var y = $p2;var x = $p1;return _(_(Language$Fay$Stdlib$quotRem)(x))(y);});};};var Language$Fay$Stdlib$min = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["unknown"],Math.min(Fay$$fayToJs(["unknown"],$p1),Fay$$fayToJs(["unknown"],$p2)));});};};var Language$Fay$Stdlib$max = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["unknown"],Math.max(Fay$$fayToJs(["unknown"],$p1),Fay$$fayToJs(["unknown"],$p2)));});};};var Language$Fay$Stdlib$recip = function($p1){return new $(function(){var x = $p1;return _(Fay$$div)(1)(_(x));});};var Language$Fay$Stdlib$fromIntegral = function($p1){return new $(function(){return Fay$$jsToFay(["double"],Fay$$fayToJs(["int"],$p1));});};var Language$Fay$Stdlib$otherwise = true;var Language$Fay$Stdlib$reverse = function($p1){return new $(function(){var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;return _(_(Language$Fay$Stdlib$$43$$43$)(_(Language$Fay$Stdlib$reverse)(xs)))(Fay$$list([x]));}if (_($p1) === null) {return null;}throw ["unhandled case in reverse",[$p1]];});};var Language$Fay$Stdlib$$61$$60$$60$ = function($p1){return function($p2){return new $(function(){var x = $p2;var f = $p1;return _(_(Fay$$bind)(x))(f);});};};var Language$Fay$Stdlib$sequence = function($p1){return new $(function(){var ms = $p1;return (function(){var k = function($p1){return function($p2){return new $(function(){var m$39$ = $p2;var m = $p1;return _(_(Fay$$bind)(m))(function($p1){var x = $p1;return _(_(Fay$$bind)(m$39$))(function($p1){var xs = $p1;return _(Fay$$$_return)(_(_(Fay$$cons)(x))(xs));});});});};};return _(_(_(Language$Fay$Stdlib$foldr)(k))(_(Fay$$$_return)(null)))(ms);})();});};var Language$Fay$Stdlib$sequence_ = function($p1){return new $(function(){if (_($p1) === null) {return _(Fay$$$_return)(Fay$$unit);}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var m = $tmp1.car;var ms = $tmp1.cdr;return _(_(Fay$$then)(m))(_(Language$Fay$Stdlib$sequence_)(ms));}throw ["unhandled case in sequence_",[$p1]];});};var Language$Fay$Stdlib$id = function($p1){return new $(function(){var x = $p1;return x;});};var Language$Fay$Stdlib$asTypeOf = new $(function(){return Language$Fay$Stdlib$$_const;});var Language$Fay$Stdlib$until = function($p1){return function($p2){return function($p3){return new $(function(){var x = $p3;var f = $p2;var p = $p1;return _(_(p)(x)) ? x : _(_(_(Language$Fay$Stdlib$until)(p))(f))(_(f)(x));});};};};var Language$Fay$Stdlib$$36$$33$ = function($p1){return function($p2){return new $(function(){var x = $p2;var f = $p1;return _(_(Fay$$seq)(x))(_(f)(x));});};};var Language$Fay$Stdlib$$33$$33$ = function($p1){return function($p2){return new $(function(){var b = $p2;var a = $p1;return (function(){var go = function($p1){return function($p2){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("(!!): index too large"));}if (_($p2) === 0) {var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var h = $tmp1.car;return h;}}var n = $p2;var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var t = $tmp1.cdr;return _(_(go)(t))(_(Fay$$sub)(_(n))(1));}throw ["unhandled case in go",[$p1,$p2]];});};};return _(_(Fay$$lt)(_(b))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("(!!): negative index")) : _(_(go)(a))(b);})();});};};var Language$Fay$Stdlib$head = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("head: empty list"));}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var h = $tmp1.car;return h;}throw ["unhandled case in head",[$p1]];});};var Language$Fay$Stdlib$tail = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("tail: empty list"));}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var t = $tmp1.cdr;return t;}throw ["unhandled case in tail",[$p1]];});};var Language$Fay$Stdlib$init = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("init: empty list"));}if (Fay$$listLen(_($p1),1)) {var a = Fay$$index(0)(_($p1));return Fay$$list([a]);}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var h = $tmp1.car;var t = $tmp1.cdr;return _(_(Fay$$cons)(h))(_(Language$Fay$Stdlib$init)(t));}throw ["unhandled case in init",[$p1]];});};var Language$Fay$Stdlib$last = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("last: empty list"));}if (Fay$$listLen(_($p1),1)) {var a = Fay$$index(0)(_($p1));return a;}var $tmp1 = _($p1);if ($tmp1 instanceof Fay$$Cons) {var t = $tmp1.cdr;return _(Language$Fay$Stdlib$last)(t);}throw ["unhandled case in last",[$p1]];});};var Language$Fay$Stdlib$iterate = function($p1){return function($p2){return new $(function(){var x = $p2;var f = $p1;return _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$iterate)(f))(_(f)(x)));});};};var Language$Fay$Stdlib$repeat = function($p1){return new $(function(){var x = $p1;return _(_(Fay$$cons)(x))(_(Language$Fay$Stdlib$repeat)(x));});};var Language$Fay$Stdlib$replicate = function($p1){return function($p2){return new $(function(){if (_($p1) === 0) {return null;}var x = $p2;var n = $p1;return _(_(Fay$$lt)(_(n))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("replicate: negative length")) : _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$replicate)(_(Fay$$sub)(_(n))(1)))(x));});};};var Language$Fay$Stdlib$cycle = function($p1){return new $(function(){if (_($p1) === null) {return _(Language$Fay$Stdlib$error)(Fay$$list("cycle: empty list"));}var xs = $p1;return (function(){var xs$39$ = new $(function(){return _(_(Language$Fay$Stdlib$$43$$43$)(xs))(xs$39$);});return xs$39$;})();});};var Language$Fay$Stdlib$take = function($p1){return function($p2){return new $(function(){if (_($p1) === 0) {return null;}if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var n = $p1;return _(_(Fay$$lt)(_(n))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("take: negative length")) : _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$take)(_(Fay$$sub)(_(n))(1)))(xs));}throw ["unhandled case in take",[$p1,$p2]];});};};var Language$Fay$Stdlib$drop = function($p1){return function($p2){return new $(function(){var xs = $p2;if (_($p1) === 0) {return xs;}if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var xs = $tmp1.cdr;var n = $p1;return _(_(Fay$$lt)(_(n))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("drop: negative length")) : _(_(Language$Fay$Stdlib$drop)(_(Fay$$sub)(_(n))(1)))(xs);}throw ["unhandled case in drop",[$p1,$p2]];});};};var Language$Fay$Stdlib$splitAt = function($p1){return function($p2){return new $(function(){var xs = $p2;if (_($p1) === 0) {return Fay$$list([null,xs]);}if (_($p2) === null) {return Fay$$list([null,null]);}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var n = $p1;return _(_(Fay$$lt)(_(n))(0)) ? _(Language$Fay$Stdlib$error)(Fay$$list("splitAt: negative length")) : (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var a = Fay$$index(0)(_($tmp1));var b = Fay$$index(1)(_($tmp1));return Fay$$list([_(_(Fay$$cons)(x))(a),b]);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$splitAt)(_(Fay$$sub)(_(n))(1)))(xs));}throw ["unhandled case in splitAt",[$p1,$p2]];});};};var Language$Fay$Stdlib$takeWhile = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(_(p)(x)) ? _(_(Fay$$cons)(x))(_(_(Language$Fay$Stdlib$takeWhile)(p))(xs)) : null;}throw ["unhandled case in takeWhile",[$p1,$p2]];});};};var Language$Fay$Stdlib$dropWhile = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(_(p)(x)) ? _(_(Language$Fay$Stdlib$dropWhile)(p))(xs) : _(_(Fay$$cons)(x))(xs);}throw ["unhandled case in dropWhile",[$p1,$p2]];});};};var Language$Fay$Stdlib$span = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return Fay$$list([null,null]);}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var p = $p1;return _(_(p)(x)) ? (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {var a = Fay$$index(0)(_($tmp1));var b = Fay$$index(1)(_($tmp1));return Fay$$list([_(_(Fay$$cons)(x))(a),b]);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$span)(p))(xs)) : Fay$$list([null,_(_(Fay$$cons)(x))(xs)]);}throw ["unhandled case in span",[$p1,$p2]];});};};var Language$Fay$Stdlib$$_break = function($p1){return new $(function(){var p = $p1;return _(Language$Fay$Stdlib$span)(_(_(Language$Fay$Stdlib$$46$)(Language$Fay$Stdlib$not))(p));});};var Language$Fay$Stdlib$print = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],(function(x) { if (console && console.log) console.log(x) })(Fay$$fayToJs(["unknown"],$p1)));});};var Language$Fay$Stdlib$putStrLn = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],(function(x) { if (console && console.log) console.log(x) })(Fay$$fayToJs(["string"],$p1)));});};var $_Language$Fay$Stdlib$Just = function(slot1){this.slot1 = slot1;};var Language$Fay$Stdlib$Just = function(slot1){return new $(function(){return new $_Language$Fay$Stdlib$Just(slot1);});};var $_Language$Fay$Stdlib$Nothing = function(){};var Language$Fay$Stdlib$Nothing = new $(function(){return new $_Language$Fay$Stdlib$Nothing();});var Automaton$main = new $(function(){return _(_(Automaton$addWindowEventListener)(Fay$$list("load")))(Automaton$run);});var Automaton$run = function($p1){return new $(function(){return _(_(Fay$$bind)(_(Automaton$jQuery)(Fay$$list("canvas"))))(function($p1){var canvas = $p1;return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(_(_(Language$Fay$Stdlib$flip)(Automaton$getContext))(Fay$$list("2d"))))(_(_(Automaton$getIndex)(canvas))(0))))(function($p1){var cxt = $p1;return _(_(Fay$$bind)(_(Automaton$newRef)(Automaton$defAutomatonState)))(function($p1){var mps = $p1;return _(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(_(Fay$$then)(_(_(_(Automaton$bind)(canvas))(Fay$$list("mousedown")))(_(_(Automaton$onMouseDown)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(canvas))(Fay$$list("mousemove")))(_(_(Automaton$onMouseMove)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(canvas))(Fay$$list("mouseup")))(_(_(Automaton$onMouseUp)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(canvas))(Fay$$list("mouseleave")))(_(_(Automaton$onMouseOutLeave)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(canvas))(Fay$$list("mouseout")))(_(_(Automaton$onMouseOutLeave)(mps))(cxt))))(_(_(Fay$$then)(_(_(Automaton$initializeInspectors)(mps))(cxt)))(_(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#delete-state"),Fay$$list("#delete-trans"),Fay$$list("#new-state"),Fay$$list("#new-trans"),Fay$$list("#run"),Fay$$list("#clear")]))))(function($p1){if (Fay$$listLen(_($p1),6)) {var delS = Fay$$index(0)(_($p1));var delT = Fay$$index(1)(_($p1));var newS = Fay$$index(2)(_($p1));var newT = Fay$$index(3)(_($p1));var start = Fay$$index(4)(_($p1));var clear = Fay$$index(5)(_($p1));return _(_(Fay$$then)(_(_(_(Automaton$bind)(delS))(Fay$$list("click")))(_(_(Automaton$deleteObject)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(delT))(Fay$$list("click")))(_(_(Automaton$deleteObject)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(newS))(Fay$$list("click")))(_(_(Automaton$createState)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(newT))(Fay$$list("click")))(_(_(Automaton$createTrans)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(start))(Fay$$list("click")))(_(_(Automaton$runAutomaton)(mps))(cxt))))(_(_(Fay$$then)(_(_(_(Automaton$bind)(clear))(Fay$$list("click")))(function($p1){return _(_(Fay$$then)(_(_(Fay$$then)(_(Automaton$unsetCurrentState)(mps)))(_(_(Automaton$renderAutomaton)(cxt))(mps))))(_(Fay$$$_return)(true));})))(_(Fay$$$_return)(false)))))));}throw ["unhandled case",$p1];}))))))));});});});});};var Automaton$initializeInspectors = function($p1){return function($p2){return new $(function(){var cxt = $p2;var asRef = $p1;return _(_(Fay$$then)(Automaton$hideInspectors))(_(_(Fay$$then)(_(_(Automaton$initializeStateInspector)(asRef))(cxt)))(_(_(Automaton$initializeTransInspector)(asRef))(cxt)));});};};var Automaton$initializeTransInspector = function($p1){return function($p2){return new $(function(){var cxt = $p2;var asRef = $p1;return _(_(Fay$$bind)(_(Automaton$jQuery)(Fay$$list("#update-trans"))))(function($p1){var update = $p1;return _(_(Language$Fay$Stdlib$$36$)(_(_(Automaton$bind)(update))(Fay$$list("click"))))(function($p1){return _(_(Fay$$bind)(_(_(Automaton$mapM)(_(_(Automaton$$60$$61$$60$)(Automaton$getValue))(Automaton$jQuery)))(Fay$$list([Fay$$list("#trans-info-from"),Fay$$list("#trans-info-inputs"),Fay$$list("#trans-info-to")]))))(function($p1){if (Fay$$listLen(_($p1),3)) {var from = Fay$$index(0)(_($p1));var inp$39$ = Fay$$index(1)(_($p1));var to = Fay$$index(2)(_($p1));return (function(){var inp = new $(function(){return _(_(Language$Fay$Stdlib$filter)(function($p1){var $gen_1 = $p1;return _(_(Language$Fay$Stdlib$notElem)($gen_1))(Fay$$list(", \t\r\n"));}))(inp$39$);});return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){var state = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return _(_(Fay$$bind)(_(Automaton$getSelectedTrans)(asRef)))(function($p1){var origTs = $p1;return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(Language$Fay$Stdlib$not)(_(Language$Fay$Stdlib$$_null)(origTs)))))((function(){var ts$39$ = new $(function(){return _(_(_(Language$Fay$Stdlib$foldr)(Automaton$$_delete))(_(Automaton$transs)(automaton)))(origTs);});var src = new $(function(){return _(Automaton$parseInt)(from);});var targ = new $(function(){return _(Automaton$parseInt)(to);});var newTs = new $(function(){var $gen_1 = function($p1){return new $(function(){var c = $p1;return _(_(_(Language$Fay$Stdlib$all)(function($p1){var t = $p1;return _(Fay$$or)(_(_(_(Fay$$neq)(_(Automaton$transFrom)(t)))(src)))(_(_(_(Fay$$neq)(_(Automaton$transAlphabet)(t)))(c)));}))(ts$39$)) ? Fay$$list([_(_(_(Automaton$Trans)(src))(c))(targ)]) : null;return null;});};return _(_(Language$Fay$Stdlib$concatMap)($gen_1))(inp);});var auto$39$ = new $(function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = _(_(Language$Fay$Stdlib$$43$$43$)(newTs))(ts$39$);return $36$_record_to_update;});var ms$39$ = new $(function(){return (function($tmp1){if (_($tmp1) instanceof $_Automaton$TransSelected) {return _(Automaton$TransSelected)(newTs);}return mouseState;})(mouseState);});return _(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(state));$36$_record_to_update.automaton = auto$39$;$36$_record_to_update.mouseState = ms$39$;return $36$_record_to_update;})())))(_(_(Automaton$renderAutomaton)(cxt))(asRef));})())))(_(Fay$$$_return)(false));});}return _(_(Fay$$bind)(_(Automaton$getSelectedTrans)(asRef)))(function($p1){var origTs = $p1;return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(Language$Fay$Stdlib$not)(_(Language$Fay$Stdlib$$_null)(origTs)))))((function(){var ts$39$ = new $(function(){return _(_(_(Language$Fay$Stdlib$foldr)(Automaton$$_delete))(_(Automaton$transs)(automaton)))(origTs);});var src = new $(function(){return _(Automaton$parseInt)(from);});var targ = new $(function(){return _(Automaton$parseInt)(to);});var newTs = new $(function(){var $gen_1 = function($p1){return new $(function(){var c = $p1;return _(_(_(Language$Fay$Stdlib$all)(function($p1){var t = $p1;return _(Fay$$or)(_(_(_(Fay$$neq)(_(Automaton$transFrom)(t)))(src)))(_(_(_(Fay$$neq)(_(Automaton$transAlphabet)(t)))(c)));}))(ts$39$)) ? Fay$$list([_(_(_(Automaton$Trans)(src))(c))(targ)]) : null;return null;});};return _(_(Language$Fay$Stdlib$concatMap)($gen_1))(inp);});var auto$39$ = new $(function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = _(_(Language$Fay$Stdlib$$43$$43$)(newTs))(ts$39$);return $36$_record_to_update;});var ms$39$ = new $(function(){return (function($tmp1){if (_($tmp1) instanceof $_Automaton$TransSelected) {return _(Automaton$TransSelected)(newTs);}return mouseState;})(mouseState);});return _(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(state));$36$_record_to_update.automaton = auto$39$;$36$_record_to_update.mouseState = ms$39$;return $36$_record_to_update;})())))(_(_(Automaton$renderAutomaton)(cxt))(asRef));})())))(_(Fay$$$_return)(false));});throw ["unhandled case",$p1];});})();}throw ["unhandled case",$p1];});});});});};};var Automaton$initializeStateInspector = function($p1){return function($p2){return new $(function(){var cxt = $p2;var asRef = $p1;return _(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#is-accepts"),Fay$$list("#is-initial"),Fay$$list("#state-name")]))))(function($p1){if (Fay$$listLen(_($p1),3)) {var isAcc = Fay$$index(0)(_($p1));var isInit = Fay$$index(1)(_($p1));var stateName = Fay$$index(2)(_($p1));return _(_(Fay$$then)(_(Automaton$disable)(stateName)))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(_(Automaton$bind)(isAcc))(Fay$$list("click"))))(function($p1){return _(_(Fay$$bind)(_(Automaton$isChecked)(isAcc)))(function($p1){var accept = $p1;return _(_(Fay$$bind)(_(Automaton$getSelectedState)(asRef)))(function($p1){var mq = $p1;return _(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {var q = _($tmp1).slot1;return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){var as = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;return (function(){var tmp = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Automaton$$_delete)(q)))(_(Automaton$accepts)(automaton));});var as$39$ = new $(function(){return _(accept) ? _(_(Fay$$cons)(q))(tmp) : tmp;});return _(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.accepts = as$39$;return $36$_record_to_update;})();return $36$_record_to_update;})());})();}return (function(){var tmp = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Automaton$$_delete)(q)))(_(Automaton$accepts)(automaton));});var as$39$ = new $(function(){return _(accept) ? _(_(Fay$$cons)(q))(tmp) : tmp;});return _(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.accepts = as$39$;return $36$_record_to_update;})();return $36$_record_to_update;})());})();throw ["unhandled case",$p1];});}if (_($tmp1) instanceof $_Language$Fay$Stdlib$Nothing) {return _(Fay$$$_return)(Fay$$unit);}return (function(){ throw (["unhandled case",$tmp1]); })();})(mq)))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(asRef)))(_(Fay$$$_return)(true)));});});})))(_(_(Language$Fay$Stdlib$$36$)(_(_(Automaton$bind)(isInit))(Fay$$list("click"))))(function($p1){return _(_(Fay$$bind)(_(Automaton$getSelectedState)(asRef)))(function($p1){var mq = $p1;return (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {var q = _($tmp1).slot1;return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){var as = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;return _(_(Fay$$then)(_(Automaton$disable)(isInit)))(_(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.initial = q;return $36$_record_to_update;})();return $36$_record_to_update;})())))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(asRef)))(_(Fay$$$_return)(true))));}return _(_(Fay$$then)(_(Automaton$disable)(isInit)))(_(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.initial = q;return $36$_record_to_update;})();return $36$_record_to_update;})())))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(asRef)))(_(Fay$$$_return)(true))));throw ["unhandled case",$p1];});}if (_($tmp1) instanceof $_Language$Fay$Stdlib$Nothing) {return _(Fay$$$_return)(false);}return (function(){ throw (["unhandled case",$tmp1]); })();})(mq);});})));}throw ["unhandled case",$p1];});});};};var Automaton$onMouseOutLeave = function($p1){return function($p2){return function($p3){return new $(function(){var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$isMouseDragging)(mps)))(function($p1){var isDragging = $p1;return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(isDragging)))(_(Automaton$setMouseIdle)(mps))))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(false)));});});};};};var Automaton$createTrans = function($p1){return function($p2){return function($p3){return new $(function(){var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(_(Automaton$mapM)(_(_(Automaton$$60$$61$$60$)(Automaton$getValue))(Automaton$jQuery)))(Fay$$list([Fay$$list("#trans-from"),Fay$$list("#trans-input"),Fay$$list("#trans-to")]))))(function($p1){if (Fay$$listLen(_($p1),3)) {var from = Fay$$index(0)(_($p1));var inps = Fay$$index(1)(_($p1));var to = Fay$$index(2)(_($p1));return (function(){var tFrom = new $(function(){return _(Automaton$parseInt)(from);});var tTo = new $(function(){return _(Automaton$parseInt)(to);});return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$forM_)(_(_(Language$Fay$Stdlib$filter)(function($p1){var $gen_1 = $p1;return _(_(Language$Fay$Stdlib$notElem)($gen_1))(Fay$$list(" \r\n\t,"));}))(inps))))(function($p1){var tAlpha = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var as = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return _(_(_(Language$Fay$Stdlib$any)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(tFrom)))(_(_(_(Fay$$eq)(_(Automaton$transAlphabet)(t)))(tAlpha)));}))(_(Automaton$transs)(automaton))) ? _(Automaton$alert)(Fay$$list("You cannot duplicate same transition condition.")) : (function(){var t$39$ = new $(function(){return _(_(_(Automaton$Trans)(tFrom))(tAlpha))(tTo);});var news = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$map)(function($p1){var a = $p1;return Fay$$list([a,Fay$$list([_(Fay$$div)(_(Automaton$canvasWidth))(2),_(Fay$$div)(_(Automaton$canvasHeight))(2)])]);})))(_(_(Language$Fay$Stdlib$filter)(function($p1){var $gen_1 = $p1;return _(_(Language$Fay$Stdlib$notElem)($gen_1))(_(_(Language$Fay$Stdlib$map)(Language$Fay$Stdlib$fst))(stateMap));}))(Fay$$list([tFrom,tTo])));});var dic$39$ = new $(function(){return _(_(Language$Fay$Stdlib$$43$$43$)(news))(stateMap);});var cnt = new $(function(){return _(_(Language$Fay$Stdlib$$_null)(news)) ? stateCount : _(Fay$$add)(1)(_(_(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$maximum))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$map)(Language$Fay$Stdlib$fst)))(stateMap))));});return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = _(_(Fay$$cons)(t$39$))(_(Automaton$transs)(automaton));return $36$_record_to_update;})();$36$_record_to_update.stateMap = dic$39$;$36$_record_to_update.stateCount = cnt;return $36$_record_to_update;})());})();}return _(_(_(Language$Fay$Stdlib$any)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(tFrom)))(_(_(_(Fay$$eq)(_(Automaton$transAlphabet)(t)))(tAlpha)));}))(_(Automaton$transs)(automaton))) ? _(Automaton$alert)(Fay$$list("You cannot duplicate same transition condition.")) : (function(){var t$39$ = new $(function(){return _(_(_(Automaton$Trans)(tFrom))(tAlpha))(tTo);});var news = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$map)(function($p1){var a = $p1;return Fay$$list([a,Fay$$list([_(Fay$$div)(_(Automaton$canvasWidth))(2),_(Fay$$div)(_(Automaton$canvasHeight))(2)])]);})))(_(_(Language$Fay$Stdlib$filter)(function($p1){var $gen_1 = $p1;return _(_(Language$Fay$Stdlib$notElem)($gen_1))(_(_(Language$Fay$Stdlib$map)(Language$Fay$Stdlib$fst))(stateMap));}))(Fay$$list([tFrom,tTo])));});var dic$39$ = new $(function(){return _(_(Language$Fay$Stdlib$$43$$43$)(news))(stateMap);});var cnt = new $(function(){return _(_(Language$Fay$Stdlib$$_null)(news)) ? stateCount : _(Fay$$add)(1)(_(_(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$maximum))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$map)(Language$Fay$Stdlib$fst)))(stateMap))));});return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = _(_(Fay$$cons)(t$39$))(_(Automaton$transs)(automaton));return $36$_record_to_update;})();$36$_record_to_update.stateMap = dic$39$;$36$_record_to_update.stateCount = cnt;return $36$_record_to_update;})());})();throw ["unhandled case",$p1];});})))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(false)));})();}throw ["unhandled case",$p1];});});};};};var Automaton$createState = function($p1){return function($p2){return function($p3){return new $(function(){var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var as = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return (function(){var q = new $(function(){return stateCount;});return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.stateCount = _(Fay$$add)(_(stateCount))(1);$36$_record_to_update.stateMap = _(_(Fay$$cons)(Fay$$list([q,Fay$$list([_(Fay$$div)(_(Automaton$canvasWidth))(2),_(Fay$$div)(_(Automaton$canvasHeight))(2)])])))(stateMap);return $36$_record_to_update;})())))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(false)));})();}return (function(){var q = new $(function(){return stateCount;});return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.stateCount = _(Fay$$add)(_(stateCount))(1);$36$_record_to_update.stateMap = _(_(Fay$$cons)(Fay$$list([q,Fay$$list([_(Fay$$div)(_(Automaton$canvasWidth))(2),_(Fay$$div)(_(Automaton$canvasHeight))(2)])])))(stateMap);return $36$_record_to_update;})())))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(false)));})();throw ["unhandled case",$p1];});});};};};var Automaton$onMouseUp = function($p1){return function($p2){return function($p3){return new $(function(){var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){if (_($p1) instanceof $_Automaton$AutomatonState) {var mouseState = _($p1).mouseState;return _(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Automaton$PointAtState) {var q = _($tmp1).slot1;return _(_(Automaton$setStateSelected)(q))(mps);}if (_($tmp1) instanceof $_Automaton$DraggingState) {return _(Automaton$setMouseIdle)(mps);}return _(Fay$$$_return)(Fay$$unit);})(mouseState)))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(true)));}throw ["unhandled case",$p1];});});};};};var Automaton$inspect = function($p1){return function($p2){return new $(function(){var ev = $p2;var ref = $p1;return _(_(Fay$$bind)(_(Automaton$offsetX)(ev)))(function($p1){var x = $p1;return _(_(Fay$$bind)(_(Automaton$offsetY)(ev)))(function($p1){var y = $p1;return _(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#mousex"),Fay$$list("#mousey")]))))(function($p1){if (Fay$$listLen(_($p1),2)) {var mouseX = Fay$$index(0)(_($p1));var mouseY = Fay$$index(1)(_($p1));return _(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#eqn1"),Fay$$list("#ans1")]))))(function($p1){if (Fay$$listLen(_($p1),2)) {var eqf1 = Fay$$index(0)(_($p1));var ansf1 = Fay$$index(1)(_($p1));return _(_(Fay$$then)(_(_(Automaton$setText)(mouseX))(_(Language$Fay$Stdlib$show)(x))))(_(_(Fay$$then)(_(_(Automaton$setText)(mouseY))(_(Language$Fay$Stdlib$show)(y))))(_(_(Fay$$bind)(_(Automaton$readRef)(ref)))(function($p1){var as = $p1;return (function(){var shape1 = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(Automaton$fromLine))(_(_(Language$Fay$Stdlib$$36$)(Automaton$fromJust))(_(_(Automaton$getTransShape)(as))(_(_(_(Automaton$Trans)(0))("0"))(1))));});var eqn1 = new $(function(){return _(_(Language$Fay$Stdlib$uncurry)(Automaton$calcEquation))(shape1);});var normal1 = new $(function(){return _(Language$Fay$Stdlib$fst)(eqn1);});var dotted1 = new $(function(){return _(Language$Fay$Stdlib$snd)(eqn1);});return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$setText)(eqf1)))(_(Language$Fay$Stdlib$concat)(Fay$$list([Fay$$list("("),_(Language$Fay$Stdlib$show)(_(Language$Fay$Stdlib$fst)(normal1)),Fay$$list(")x + ("),_(Language$Fay$Stdlib$show)(_(Language$Fay$Stdlib$snd)(normal1)),Fay$$list(")y = "),_(Language$Fay$Stdlib$show)(dotted1)])))))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$setText)(ansf1)))(_(Language$Fay$Stdlib$show)(_(_(Automaton$$60$$46$$62$)(Fay$$list([x,y])))(normal1)))))(_(Fay$$$_return)(false)));})();})));}throw ["unhandled case",$p1];});}throw ["unhandled case",$p1];});});});});};};var Automaton$onMouseMove = function($p1){return function($p2){return function($p3){return new $(function(){var ev = $p3;var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var pstate = $p1;return (function(){var mouse = new $(function(){return _(Automaton$mouseState)(pstate);});return _(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Automaton$PointAtState) {var nid = _($tmp1).slot1;return _(_(Automaton$setMouseState)(mps))(_(Automaton$DraggingState)(nid));}if (_($tmp1) instanceof $_Automaton$DraggingState) {var nid = _($tmp1).slot1;return _(_(Fay$$bind)(_(Automaton$offsetX)(ev)))(function($p1){var x = $p1;return _(_(Fay$$bind)(_(Automaton$offsetY)(ev)))(function($p1){var y = $p1;return (function(){var dic = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$filter)(_(_(Language$Fay$Stdlib$$46$)(function($p1){var $gen_2 = $p1;return _(_(Fay$$neq)($gen_2))(nid);}))(Language$Fay$Stdlib$fst))))(_(Automaton$stateMap)(pstate));});return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(pstate));$36$_record_to_update.stateMap = _(_(Fay$$cons)(Fay$$list([nid,Fay$$list([x,y])])))(dic);return $36$_record_to_update;})());})();});});}return _(Fay$$$_return)(Fay$$unit);})(mouse)))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(false)));})();});});};};};var Automaton$onMouseDown = function($p1){return function($p2){return function($p3){return new $(function(){var ev = $p3;var cxt = $p2;var rps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(rps)))(function($p1){var ps = $p1;return _(_(Fay$$bind)(_(Automaton$getMousePos)(ev)))(function($p1){var pos = $p1;return (function(){var state = new $(function(){return _(_(Automaton$getStateAt)(ps))(pos);});var trans = new $(function(){return _(_(Automaton$getTransAt)(ps))(pos);});return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$not)(_(Language$Fay$Stdlib$$_null)(trans))) ? _(_(_(Fay$$eq)(_(Automaton$mouseState)(ps)))(_(Automaton$TransSelected)(trans))) ? _(Automaton$setMouseIdle)(rps) : _(_(Automaton$setTransSelected)(trans))(rps) : (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {var q = _($tmp1).slot1;return _(_(_(Fay$$eq)(_(Automaton$mouseState)(ps)))(_(Automaton$StateSelected)(q))) ? _(Automaton$setMouseIdle)(rps) : _(_(Automaton$setMouseState)(rps))(_(Automaton$PointAtState)(q));}if (_($tmp1) instanceof $_Language$Fay$Stdlib$Nothing) {return _(Automaton$setMouseIdle)(rps);}return (function(){ throw (["unhandled case",$tmp1]); })();})(state)))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(rps)))(_(Fay$$$_return)(false)));})();});});});};};};var Automaton$setCurrentState = function($p1){return function($p2){return new $(function(){var q = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ps = $p1;return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.activeState = _(Automaton$StateProgress)(q);return $36$_record_to_update;})());});});};};var Automaton$unsetCurrentState = function($p1){return new $(function(){var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ps = $p1;return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.activeState = Automaton$NoActiveState;return $36$_record_to_update;})());});});};var Automaton$getSelectedState = function($p1){return new $(function(){var asRef = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){if (_($p1) instanceof $_Automaton$AutomatonState) {var mouseState = _($p1).mouseState;return (function($tmp1){if (_($tmp1) instanceof $_Automaton$StateSelected) {var q = _($tmp1).slot1;return _(_(Language$Fay$Stdlib$$36$)(Fay$$$_return))(_(Language$Fay$Stdlib$Just)(q));}return _(Fay$$$_return)(Language$Fay$Stdlib$Nothing);})(mouseState);}throw ["unhandled case",$p1];});});};var Automaton$getSelectedTrans = function($p1){return new $(function(){var asRef = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){if (_($p1) instanceof $_Automaton$AutomatonState) {var mouseState = _($p1).mouseState;return (function($tmp1){if (_($tmp1) instanceof $_Automaton$TransSelected) {var ts = _($tmp1).slot1;return _(Fay$$$_return)(ts);}return _(Fay$$$_return)(null);})(mouseState);}throw ["unhandled case",$p1];});});};var Automaton$setStateSelected = function($p1){return function($p2){return new $(function(){var asRef = $p2;var q = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){var as = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return _(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.mouseState = _(Automaton$StateSelected)(q);return $36$_record_to_update;})())))(_(_(Fay$$then)(Automaton$hideInspectors))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(Automaton$expose))(_(Automaton$jQuery)(Fay$$list("#state-inspector")))))(_(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#state-name"),Fay$$list("#is-initial"),Fay$$list("#is-accepts")]))))(function($p1){if (Fay$$listLen(_($p1),3)) {var sName = Fay$$index(0)(_($p1));var isInitial = Fay$$index(1)(_($p1));var isAccepts = Fay$$index(2)(_($p1));return _(_(Fay$$then)(_(_(Automaton$setValue)(sName))(_(Language$Fay$Stdlib$show)(q))))(_(_(Fay$$then)(_(_(Automaton$setChecked)(isInitial))(_(_(Fay$$eq)(q))(_(Automaton$initial)(automaton)))))(_(_(Fay$$then)(_(_(Automaton$setDisabled)(isInitial))(_(_(Fay$$eq)(q))(_(Automaton$initial)(automaton)))))(_(_(Automaton$setChecked)(isAccepts))(_(_(Language$Fay$Stdlib$elem)(q))(_(Automaton$accepts)(automaton))))));}throw ["unhandled case",$p1];}))));}return _(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.mouseState = _(Automaton$StateSelected)(q);return $36$_record_to_update;})())))(_(_(Fay$$then)(Automaton$hideInspectors))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(Automaton$expose))(_(Automaton$jQuery)(Fay$$list("#state-inspector")))))(_(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#state-name"),Fay$$list("#is-initial"),Fay$$list("#is-accepts")]))))(function($p1){if (Fay$$listLen(_($p1),3)) {var sName = Fay$$index(0)(_($p1));var isInitial = Fay$$index(1)(_($p1));var isAccepts = Fay$$index(2)(_($p1));return _(_(Fay$$then)(_(_(Automaton$setValue)(sName))(_(Language$Fay$Stdlib$show)(q))))(_(_(Fay$$then)(_(_(Automaton$setChecked)(isInitial))(_(_(Fay$$eq)(q))(_(Automaton$initial)(automaton)))))(_(_(Fay$$then)(_(_(Automaton$setDisabled)(isInitial))(_(_(Fay$$eq)(q))(_(Automaton$initial)(automaton)))))(_(_(Automaton$setChecked)(isAccepts))(_(_(Language$Fay$Stdlib$elem)(q))(_(Automaton$accepts)(automaton))))));}throw ["unhandled case",$p1];}))));throw ["unhandled case",$p1];});});};};var Automaton$setTransSelected = function($p1){return function($p2){return new $(function(){var asRef = $p2;var ts = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(asRef)))(function($p1){var as = $p1;return _(_(Fay$$then)(_(_(Automaton$writeRef)(asRef))((function(){var $36$_record_to_update = Object.create(_(as));$36$_record_to_update.mouseState = _(Automaton$TransSelected)(ts);return $36$_record_to_update;})())))(_(_(Fay$$then)(Automaton$hideInspectors))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(Automaton$expose))(_(Automaton$jQuery)(Fay$$list("#trans-inspector")))))(_(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("#trans-info-from"),Fay$$list("#trans-info-inputs"),Fay$$list("#trans-info-to")]))))(function($p1){if (Fay$$listLen(_($p1),3)) {var tFrom = Fay$$index(0)(_($p1));var tInps = Fay$$index(1)(_($p1));var tTo = Fay$$index(2)(_($p1));return _(_(Fay$$then)(_(_(Automaton$setValue)(tFrom))(_(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$show))(_(_(Language$Fay$Stdlib$$36$)(Automaton$transFrom))(_(Language$Fay$Stdlib$head)(ts))))))(_(_(Fay$$then)(_(_(Automaton$setValue)(tTo))(_(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$show))(_(_(Language$Fay$Stdlib$$36$)(Automaton$transTo))(_(Language$Fay$Stdlib$head)(ts))))))(_(_(Language$Fay$Stdlib$$61$$60$$60$)(_(Automaton$setValue)(tInps)))(_(Automaton$arrToStr)(_(_(Language$Fay$Stdlib$map)(Automaton$transAlphabet))(ts)))));}throw ["unhandled case",$p1];}))));});});};};var Automaton$hideInspectors = new $(function(){return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(Automaton$hide))(_(Automaton$jQuery)(Fay$$list("#state-inspector")))))(_(_(Language$Fay$Stdlib$$61$$60$$60$)(Automaton$hide))(_(Automaton$jQuery)(Fay$$list("#trans-inspector"))));});var Automaton$setMouseIdle = function($p1){return new $(function(){var mps = $p1;return _(_(Fay$$then)(_(_(Automaton$setMouseState)(mps))(Automaton$Idle)))(Automaton$hideInspectors);});};var Automaton$isMouseDragging = function($p1){return new $(function(){var rps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(rps)))(function($p1){if (_($p1) instanceof $_Automaton$AutomatonState) {var mouseState = _($p1).mouseState;return (function($tmp1){if (_($tmp1) instanceof $_Automaton$DraggingState) {return _(Fay$$$_return)(true);}return _(Fay$$$_return)(false);})(mouseState);}throw ["unhandled case",$p1];});});};var Automaton$setMouseState = function($p1){return function($p2){return new $(function(){var mState = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ps = $p1;return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.mouseState = mState;return $36$_record_to_update;})());});});};};var Automaton$getTransShape = function($p1){return function($p2){return new $(function(){if (_($p2) instanceof $_Automaton$Trans) {var src = _($p2).transFrom;var targ = _($p2).transTo;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return (function($tmp1){if (Fay$$listLen(_($tmp1),2)) {if (_(Fay$$index(0)(_($tmp1))) instanceof $_Language$Fay$Stdlib$Just) {var p0 = _(Fay$$index(0)(_($tmp1))).slot1;if (Fay$$listLen(_(_(Fay$$index(0)(_($tmp1))).slot1),2)) {var x = Fay$$index(0)(_(_(Fay$$index(0)(_($tmp1))).slot1));var y = Fay$$index(1)(_(_(Fay$$index(0)(_($tmp1))).slot1));if (_(Fay$$index(1)(_($tmp1))) instanceof $_Language$Fay$Stdlib$Just) {var p1 = _(Fay$$index(1)(_($tmp1))).slot1;if (Fay$$listLen(_(_(Fay$$index(1)(_($tmp1))).slot1),2)) {var x$39$ = Fay$$index(0)(_(_(Fay$$index(1)(_($tmp1))).slot1));var y$39$ = Fay$$index(1)(_(_(Fay$$index(1)(_($tmp1))).slot1));return _(_(_(Fay$$eq)(p0))(p1)) ? _(Language$Fay$Stdlib$Just)(_(Automaton$Arc)(p0)) : (function(){var theta = new $(function(){return _(_(_(Fay$$lte)(x))(x$39$)) ? _(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$))))) : _(Fay$$add)(_(Language$Fay$Stdlib$pi))(_(_(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$)))))));});return _(_(_(Language$Fay$Stdlib$any)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(targ)))(_(_(_(Fay$$eq)(_(Automaton$transTo)(t)))(src)));}))(_(Automaton$transs)(automaton))) ? _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$add)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8))))))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$sub)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8)))))))) : _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))));})();}return _(_(_(Fay$$eq)(p0))(p1)) ? _(Language$Fay$Stdlib$Just)(_(Automaton$Arc)(p0)) : (function(){var theta = new $(function(){return _(_(_(Fay$$lte)(x))(x$39$)) ? _(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$))))) : _(Fay$$add)(_(Language$Fay$Stdlib$pi))(_(_(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$)))))));});return _(_(_(Language$Fay$Stdlib$any)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(targ)))(_(_(_(Fay$$eq)(_(Automaton$transTo)(t)))(src)));}))(_(Automaton$transs)(automaton))) ? _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$add)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8))))))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$sub)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8)))))))) : _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))));})();}}if (_(Fay$$index(1)(_($tmp1))) instanceof $_Language$Fay$Stdlib$Just) {var p1 = _(Fay$$index(1)(_($tmp1))).slot1;if (Fay$$listLen(_(_(Fay$$index(1)(_($tmp1))).slot1),2)) {var x$39$ = Fay$$index(0)(_(_(Fay$$index(1)(_($tmp1))).slot1));var y$39$ = Fay$$index(1)(_(_(Fay$$index(1)(_($tmp1))).slot1));return _(_(_(Fay$$eq)(p0))(p1)) ? _(Language$Fay$Stdlib$Just)(_(Automaton$Arc)(p0)) : (function(){var theta = new $(function(){return _(_(_(Fay$$lte)(x))(x$39$)) ? _(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$))))) : _(Fay$$add)(_(Language$Fay$Stdlib$pi))(_(_(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$)))))));});return _(_(_(Language$Fay$Stdlib$any)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(targ)))(_(_(_(Fay$$eq)(_(Automaton$transTo)(t)))(src)));}))(_(Automaton$transs)(automaton))) ? _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$add)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8))))))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$sub)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8)))))))) : _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))));})();}return _(_(_(Fay$$eq)(p0))(p1)) ? _(Language$Fay$Stdlib$Just)(_(Automaton$Arc)(p0)) : (function(){var theta = new $(function(){return _(_(_(Fay$$lte)(x))(x$39$)) ? _(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$))))) : _(Fay$$add)(_(Language$Fay$Stdlib$pi))(_(_(Language$Fay$Stdlib$atan)(_(Fay$$div)(_(_(Fay$$sub)(_(y))(_(y$39$))))(_(_(Fay$$sub)(_(x))(_(x$39$)))))));});return _(_(_(Language$Fay$Stdlib$any)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(targ)))(_(_(_(Fay$$eq)(_(Automaton$transTo)(t)))(src)));}))(_(Automaton$transs)(automaton))) ? _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$add)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8))))))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(_(Fay$$sub)(_(theta))(_(_(Fay$$div)(_(Language$Fay$Stdlib$pi))(8)))))))) : _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(_(Automaton$Line)(_(_(Automaton$$37$$43$)(p0))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))))(_(_(Automaton$$37$$45$)(p1))(_(_(Automaton$$37$$42$)(Automaton$stateRadius))(_(Automaton$angle)(theta)))));})();}}}return Language$Fay$Stdlib$Nothing;})(Fay$$list([_(_(Language$Fay$Stdlib$lookup)(src))(stateMap),_(_(Language$Fay$Stdlib$lookup)(targ))(stateMap)]));}}throw ["unhandled case in getTransShape",[$p1,$p2]];});};};var Automaton$deleteObject = function($p1){return function($p2){return function($p3){return new $(function(){var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return _(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Automaton$StateSelected) {var q = _($tmp1).slot1;return _(_(Fay$$bind)(_(_(Automaton$deleteState)(mps))(q)))(function($p1){var succeeded = $p1;return _(succeeded) ? _(Automaton$setMouseIdle)(mps) : _(Automaton$alert)(Fay$$list("You can't delete initial state."));});}if (_($tmp1) instanceof $_Automaton$TransSelected) {var trs = _($tmp1).slot1;return _(_(Fay$$then)(_(_(Automaton$mapM)(_(Automaton$deleteTrans)(mps)))(trs)))(_(Automaton$setMouseIdle)(mps));}return _(Fay$$$_return)(Fay$$unit);})(mouseState)))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(Fay$$$_return)(false)));}throw ["unhandled case",$p1];});});};};};var Automaton$deleteTrans = function($p1){return function($p2){return new $(function(){var tr = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ps = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = _(_(Automaton$$_delete)(tr))(_(Automaton$transs)(automaton));return $36$_record_to_update;})();return $36$_record_to_update;})());}return _(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = _(_(Automaton$$_delete)(tr))(_(Automaton$transs)(automaton));return $36$_record_to_update;})();return $36$_record_to_update;})());throw ["unhandled case",$p1];});});};};var Automaton$deleteState = function($p1){return function($p2){return new $(function(){var q = $p2;var mps = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ps = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;var stateMap = _($p1).stateMap;var stateCount = _($p1).stateCount;var mouseState = _($p1).mouseState;var activeState = _($p1).activeState;return _(_(_(Fay$$eq)(_(Automaton$initial)(automaton)))(q)) ? _(Fay$$$_return)(false) : (function(){var ts = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$filter)(_(_(Language$Fay$Stdlib$$46$)(function($p1){var $gen_1 = $p1;return _(_(Language$Fay$Stdlib$notElem)(q))($gen_1);}))(Automaton$transEndPoints))))(_(Automaton$transs)(automaton));});var as = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Automaton$$_delete)(q)))(_(Automaton$accepts)(automaton));});var nMap = new $(function(){return _(_(Language$Fay$Stdlib$filter)(_(_(Language$Fay$Stdlib$$46$)(function($p1){var $gen_1 = $p1;return _(_(Fay$$neq)($gen_1))(q);}))(Language$Fay$Stdlib$fst)))(stateMap);});return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = ts;$36$_record_to_update.accepts = as;return $36$_record_to_update;})();$36$_record_to_update.stateMap = nMap;return $36$_record_to_update;})())))(_(Fay$$$_return)(true));})();}return _(_(_(Fay$$eq)(_(Automaton$initial)(automaton)))(q)) ? _(Fay$$$_return)(false) : (function(){var ts = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$filter)(_(_(Language$Fay$Stdlib$$46$)(function($p1){var $gen_1 = $p1;return _(_(Language$Fay$Stdlib$notElem)(q))($gen_1);}))(Automaton$transEndPoints))))(_(Automaton$transs)(automaton));});var as = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(_(Automaton$$_delete)(q)))(_(Automaton$accepts)(automaton));});var nMap = new $(function(){return _(_(Language$Fay$Stdlib$filter)(_(_(Language$Fay$Stdlib$$46$)(function($p1){var $gen_1 = $p1;return _(_(Fay$$neq)($gen_1))(q);}))(Language$Fay$Stdlib$fst)))(stateMap);});return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ps));$36$_record_to_update.automaton = (function(){var $36$_record_to_update = Object.create(_(automaton));$36$_record_to_update.transs = ts;$36$_record_to_update.accepts = as;return $36$_record_to_update;})();$36$_record_to_update.stateMap = nMap;return $36$_record_to_update;})())))(_(Fay$$$_return)(true));})();throw ["unhandled case",$p1];});});};};var Automaton$runAutomaton = function($p1){return function($p2){return function($p3){return new $(function(){var cxt = $p2;var mps = $p1;return _(_(Fay$$bind)(_(_(Automaton$mapM)(Automaton$jQuery))(Fay$$list([Fay$$list("input"),Fay$$list("button")]))))(function($p1){var items = $p1;return _(_(Fay$$bind)(_(Automaton$jQuery)(Fay$$list("#stop"))))(function($p1){var stopBtn = $p1;return _(_(Fay$$bind)(_(Automaton$jQuery)(Fay$$list("#ainput"))))(function($p1){var input = $p1;return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$mapM_)(Automaton$disable))(items)))(_(_(Fay$$then)(_(_(Automaton$setDisabled)(stopBtn))(false)))(_(_(Fay$$then)(_(Automaton$setMouseIdle)(mps)))(_(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;return _(_(Fay$$then)(_(_(Automaton$setCurrentState)(mps))(_(Automaton$initial)(automaton))))(_(_(Fay$$bind)(_(Automaton$newRef)(Language$Fay$Stdlib$Nothing)))(function($p1){var refTimer = $p1;return _(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))((function(){var finalize = new $(function(){return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(_(_(Language$Fay$Stdlib$maybe)(_(Fay$$$_return)(Fay$$unit)))(Automaton$clearInterval)))(_(Automaton$readRef)(refTimer))))(_(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ap = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var activeState = _($p1).activeState;return (function(){var final = new $(function(){return (function($tmp1){if (_($tmp1) instanceof $_Automaton$StateProgress) {var q = _($tmp1).slot1;return _(_(_(Language$Fay$Stdlib$elem)(q))(_(Automaton$accepts)(automaton))) ? _(Automaton$StateAccepted)(q) : _(Automaton$StateRejected)(q);}var st = $tmp1;return st;})(activeState);});return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ap));$36$_record_to_update.activeState = final;return $36$_record_to_update;})())))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(_(Language$Fay$Stdlib$mapM_)(Automaton$enable))(items)));})();}return (function(){var final = new $(function(){return (function($tmp1){if (_($tmp1) instanceof $_Automaton$StateProgress) {var q = _($tmp1).slot1;return _(_(_(Language$Fay$Stdlib$elem)(q))(_(Automaton$accepts)(automaton))) ? _(Automaton$StateAccepted)(q) : _(Automaton$StateRejected)(q);}var st = $tmp1;return st;})(activeState);});return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ap));$36$_record_to_update.activeState = final;return $36$_record_to_update;})())))(_(_(Fay$$then)(_(_(Automaton$renderAutomaton)(cxt))(mps)))(_(_(Language$Fay$Stdlib$mapM_)(Automaton$enable))(items)));})();throw ["unhandled case",$p1];}));});return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$61$$60$$60$)(Automaton$newRef))(_(Automaton$getValue)(input))))(function($p1){var string = $p1;return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$setInterval)(500)))(_(_(Fay$$bind)(_(Automaton$readRef)(mps)))(function($p1){var ap = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var activeState = _($p1).activeState;return _(_(Fay$$bind)(_(Automaton$readRef)(string)))(function($p1){var curStr = $p1;return _(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Automaton$StateProgress) {var q = _($tmp1).slot1;return (function($tmp2){if (_($tmp2) === null) {return finalize;}var $tmp3 = _($tmp2);if ($tmp3 instanceof Fay$$Cons) {var a = $tmp3.car;var as = $tmp3.cdr;return _(_(Fay$$then)(_(_(Automaton$writeRef)(string))(as)))((function($tmp3){if (_($tmp3) instanceof $_Language$Fay$Stdlib$Just) {var q$39$ = _($tmp3).slot1;return _(_(Fay$$then)(_(_(Automaton$setCurrentState)(mps))(q$39$)))(_(_(Automaton$renderAutomaton)(cxt))(mps));}if (_($tmp3) instanceof $_Language$Fay$Stdlib$Nothing) {return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ap));$36$_record_to_update.activeState = _(Automaton$StateRejected)(q);return $36$_record_to_update;})())))(finalize);}return (function(){ throw (["unhandled case",$tmp3]); })();})(_(_(_(Automaton$execute)(automaton))(q))(a)));}return (function(){ throw (["unhandled case",$tmp2]); })();})(curStr);}return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ap));$36$_record_to_update.activeState = Automaton$NoActiveState;return $36$_record_to_update;})())))(finalize);})(activeState)))(_(Fay$$$_return)(Fay$$unit));});}return _(_(Fay$$bind)(_(Automaton$readRef)(string)))(function($p1){var curStr = $p1;return _(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Automaton$StateProgress) {var q = _($tmp1).slot1;return (function($tmp2){if (_($tmp2) === null) {return finalize;}var $tmp3 = _($tmp2);if ($tmp3 instanceof Fay$$Cons) {var a = $tmp3.car;var as = $tmp3.cdr;return _(_(Fay$$then)(_(_(Automaton$writeRef)(string))(as)))((function($tmp3){if (_($tmp3) instanceof $_Language$Fay$Stdlib$Just) {var q$39$ = _($tmp3).slot1;return _(_(Fay$$then)(_(_(Automaton$setCurrentState)(mps))(q$39$)))(_(_(Automaton$renderAutomaton)(cxt))(mps));}if (_($tmp3) instanceof $_Language$Fay$Stdlib$Nothing) {return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ap));$36$_record_to_update.activeState = _(Automaton$StateRejected)(q);return $36$_record_to_update;})())))(finalize);}return (function(){ throw (["unhandled case",$tmp3]); })();})(_(_(_(Automaton$execute)(automaton))(q))(a)));}return (function(){ throw (["unhandled case",$tmp2]); })();})(curStr);}return _(_(Fay$$then)(_(_(Automaton$writeRef)(mps))((function(){var $36$_record_to_update = Object.create(_(ap));$36$_record_to_update.activeState = Automaton$NoActiveState;return $36$_record_to_update;})())))(finalize);})(activeState)))(_(Fay$$$_return)(Fay$$unit));});throw ["unhandled case",$p1];}))))(function($p1){var aTimer = $p1;return _(_(Fay$$then)(_(_(Automaton$writeRef)(refTimer))(_(Language$Fay$Stdlib$Just)(aTimer))))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(_(Automaton$bind)(stopBtn))(Fay$$list("click"))))(function($p1){return _(_(Fay$$then)(finalize))(_(Fay$$$_return)(false));})))(_(Fay$$$_return)(true)));});});})());}));}throw ["unhandled case",$p1];}))));});});});});};};};var Automaton$execute = function($p1){return function($p2){return function($p3){return new $(function(){var c = $p3;var q = $p2;var auto = $p1;return (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {var t = _($tmp1).slot1;return _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$Just))(_(Automaton$transTo)(t));}if (_($tmp1) instanceof $_Language$Fay$Stdlib$Nothing) {return Language$Fay$Stdlib$Nothing;}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(_(Automaton$lookupTrans)(auto))(q))(c));});};};};var $_Automaton$Arc = function(slot1){this.slot1 = slot1;};var Automaton$Arc = function(slot1){return new $(function(){return new $_Automaton$Arc(slot1);});};var $_Automaton$Line = function(slot1,slot2){this.slot1 = slot1;this.slot2 = slot2;};var Automaton$Line = function(slot1){return function(slot2){return new $(function(){return new $_Automaton$Line(slot1,slot2);});};};var Automaton$$60$$46$$62$ = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x$39$ = Fay$$index(0)(_($p2));var y$39$ = Fay$$index(1)(_($p2));if (Fay$$listLen(_($p1),2)) {var x = Fay$$index(0)(_($p1));var y = Fay$$index(1)(_($p1));return _(Fay$$add)(_(_(Fay$$mult)(_(x))(_(x$39$))))(_(_(Fay$$mult)(_(y))(_(y$39$))));}}throw ["unhandled case in (<.>)",[$p1,$p2]];});};};var Automaton$$37$$45$ = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x$39$ = Fay$$index(0)(_($p2));var y$39$ = Fay$$index(1)(_($p2));if (Fay$$listLen(_($p1),2)) {var x = Fay$$index(0)(_($p1));var y = Fay$$index(1)(_($p1));return Fay$$list([_(Fay$$sub)(_(x))(_(x$39$)),_(Fay$$sub)(_(y))(_(y$39$))]);}}throw ["unhandled case in (%-)",[$p1,$p2]];});};};var Automaton$$37$$43$ = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x$39$ = Fay$$index(0)(_($p2));var y$39$ = Fay$$index(1)(_($p2));if (Fay$$listLen(_($p1),2)) {var x = Fay$$index(0)(_($p1));var y = Fay$$index(1)(_($p1));return Fay$$list([_(Fay$$add)(_(x))(_(x$39$)),_(Fay$$add)(_(y))(_(y$39$))]);}}throw ["unhandled case in (%+)",[$p1,$p2]];});};};var Automaton$$37$$42$ = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x$39$ = Fay$$index(0)(_($p2));var y$39$ = Fay$$index(1)(_($p2));var t = $p1;return Fay$$list([_(Fay$$mult)(_(t))(_(x$39$)),_(Fay$$mult)(_(t))(_(y$39$))]);}throw ["unhandled case in (%*)",[$p1,$p2]];});};};var Automaton$angle = function($p1){return new $(function(){var rad = $p1;return Fay$$list([_(Language$Fay$Stdlib$cos)(rad),_(Language$Fay$Stdlib$sin)(rad)]);});};var Automaton$getMousePos = function($p1){return new $(function(){var ev = $p1;return _(_(Fay$$bind)(_(Automaton$offsetX)(ev)))(function($p1){var x = $p1;return _(_(Fay$$bind)(_(Automaton$offsetY)(ev)))(function($p1){var y = $p1;return _(Fay$$$_return)(Fay$$list([x,y]));});});});};var Automaton$fromLine = function($p1){return new $(function(){if (_($p1) instanceof $_Automaton$Line) {var x = _($p1).slot1;var y = _($p1).slot2;return Fay$$list([x,y]);}throw ["unhandled case in fromLine",[$p1]];});};var Automaton$calcEquation = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x$39$ = Fay$$index(0)(_($p2));var y$39$ = Fay$$index(1)(_($p2));if (Fay$$listLen(_($p1),2)) {var x = Fay$$index(0)(_($p1));var y = Fay$$index(1)(_($p1));return (function(){var xCoeff = new $(function(){return _(Fay$$sub)(_(y))(_(y$39$));});var yCoeff = new $(function(){return _(Fay$$sub)(_(x$39$))(_(x));});var dotted = new $(function(){return _(Fay$$sub)(_(_(Fay$$mult)(_(x$39$))(_(y))))(_(_(Fay$$mult)(_(y$39$))(_(x))));});return Fay$$list([Fay$$list([xCoeff,yCoeff]),dotted]);})();}}throw ["unhandled case in calcEquation",[$p1,$p2]];});};};var Automaton$getStateAt = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var atX = Fay$$index(0)(_($p2));var atY = Fay$$index(1)(_($p2));if (_($p1) instanceof $_Automaton$AutomatonState) {var stateMap = _($p1).stateMap;return (function(){var isIn = function($p1){return new $(function(){if (Fay$$listLen(_($p1),2)) {var origX = Fay$$index(0)(_($p1));var origY = Fay$$index(1)(_($p1));return _(_(Fay$$lte)(_(Fay$$add)(_(_(_(Language$Fay$Stdlib$$94$)(_(Fay$$sub)(_(origX))(_(atX))))(2)))(_(_(_(Language$Fay$Stdlib$$94$)(_(Fay$$sub)(_(origY))(_(atY))))(2)))))(_(_(Language$Fay$Stdlib$$94$)(Automaton$stateRadius))(2));}throw ["unhandled case in isIn",[$p1]];});};return _(_(Language$Fay$Stdlib$$36$)(_(_(Language$Fay$Stdlib$maybe)(Language$Fay$Stdlib$Nothing))(_(_(Language$Fay$Stdlib$$46$)(Language$Fay$Stdlib$Just))(Language$Fay$Stdlib$fst))))(_(_(Language$Fay$Stdlib$find)(_(_(Language$Fay$Stdlib$$46$)(isIn))(Language$Fay$Stdlib$snd)))(stateMap));})();}}throw ["unhandled case in getStateAt",[$p1,$p2]];});};};var Automaton$getTransAt = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var atX = Fay$$index(0)(_($p2));var atY = Fay$$index(1)(_($p2));var as = $p1;if (_($p1) instanceof $_Automaton$AutomatonState) {var automaton = _($p1).automaton;return (function(){var isOn = function($p1){return new $(function(){var trans = $p1;return (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {if (_(_($tmp1).slot1) instanceof $_Automaton$Line) {if (Fay$$listLen(_(_(_($tmp1).slot1).slot1),2)) {var x = Fay$$index(0)(_(_(_($tmp1).slot1).slot1));var y = Fay$$index(1)(_(_(_($tmp1).slot1).slot1));if (Fay$$listLen(_(_(_($tmp1).slot1).slot2),2)) {var x$39$ = Fay$$index(0)(_(_(_($tmp1).slot1).slot2));var y$39$ = Fay$$index(1)(_(_(_($tmp1).slot1).slot2));return (function(){var eqn = new $(function(){return _(_(Automaton$calcEquation)(Fay$$list([x,y])))(Fay$$list([x$39$,y$39$]));});var normal = new $(function(){return _(Language$Fay$Stdlib$fst)(eqn);});var dotted = new $(function(){return _(Language$Fay$Stdlib$snd)(eqn);});return _(Fay$$and)(_(_(_(Fay$$lte)(_(Language$Fay$Stdlib$abs)(_(Fay$$sub)(_(_(_(Automaton$$60$$46$$62$)(Fay$$list([atX,atY])))(normal)))(_(dotted)))))(_(Language$Fay$Stdlib$abs)(_(_(Automaton$$60$$46$$62$)(Fay$$list([5,5])))(normal)))))(_(_(Fay$$and)(_(_(Fay$$or)(_(_(_(Fay$$eq)(x))(x$39$)))(_(_(Fay$$and)(_(_(_(Fay$$lte)(_(_(Language$Fay$Stdlib$min)(x))(x$39$)))(atX)))(_(_(_(Fay$$lte)(atX))(_(_(Language$Fay$Stdlib$max)(x))(x$39$))))))))(_(_(Fay$$or)(_(_(_(Fay$$eq)(y))(y$39$)))(_(_(Fay$$and)(_(_(_(Fay$$lte)(_(Fay$$sub)(_(_(_(Language$Fay$Stdlib$min)(y))(y$39$)))(_(atY))))(5)))(_(_(_(Fay$$lte)(atY))(_(_(Language$Fay$Stdlib$max)(y))(y$39$))))))))));})();}}}if (_(_($tmp1).slot1) instanceof $_Automaton$Arc) {if (Fay$$listLen(_(_(_($tmp1).slot1).slot1),2)) {var x = Fay$$index(0)(_(_(_($tmp1).slot1).slot1));var y = Fay$$index(1)(_(_(_($tmp1).slot1).slot1));return _(Fay$$and)(_(_(_(Fay$$lte)(_(Language$Fay$Stdlib$abs)(_(Fay$$sub)(_(Automaton$stateRadius))(_(_(_(Automaton$distance)(Fay$$list([x,_(Fay$$add)(_(y))(_(Automaton$stateRadius))])))(Fay$$list([atX,atY])))))))(5)))(_(_(_(Fay$$lte)(_(Fay$$add)(_(y))(_(_(Fay$$div)(_(Automaton$stateRadius))(_(_(Language$Fay$Stdlib$sqrt)(2)))))))(atY)));}}}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Automaton$getTransShape)(as))(trans));});};return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$filter)(isOn)))(_(Automaton$transs)(automaton));})();}return (function(){var isOn = function($p1){return new $(function(){var trans = $p1;return (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {if (_(_($tmp1).slot1) instanceof $_Automaton$Line) {if (Fay$$listLen(_(_(_($tmp1).slot1).slot1),2)) {var x = Fay$$index(0)(_(_(_($tmp1).slot1).slot1));var y = Fay$$index(1)(_(_(_($tmp1).slot1).slot1));if (Fay$$listLen(_(_(_($tmp1).slot1).slot2),2)) {var x$39$ = Fay$$index(0)(_(_(_($tmp1).slot1).slot2));var y$39$ = Fay$$index(1)(_(_(_($tmp1).slot1).slot2));return (function(){var eqn = new $(function(){return _(_(Automaton$calcEquation)(Fay$$list([x,y])))(Fay$$list([x$39$,y$39$]));});var normal = new $(function(){return _(Language$Fay$Stdlib$fst)(eqn);});var dotted = new $(function(){return _(Language$Fay$Stdlib$snd)(eqn);});return _(Fay$$and)(_(_(_(Fay$$lte)(_(Language$Fay$Stdlib$abs)(_(Fay$$sub)(_(_(_(Automaton$$60$$46$$62$)(Fay$$list([atX,atY])))(normal)))(_(dotted)))))(_(Language$Fay$Stdlib$abs)(_(_(Automaton$$60$$46$$62$)(Fay$$list([5,5])))(normal)))))(_(_(Fay$$and)(_(_(Fay$$or)(_(_(_(Fay$$eq)(x))(x$39$)))(_(_(Fay$$and)(_(_(_(Fay$$lte)(_(_(Language$Fay$Stdlib$min)(x))(x$39$)))(atX)))(_(_(_(Fay$$lte)(atX))(_(_(Language$Fay$Stdlib$max)(x))(x$39$))))))))(_(_(Fay$$or)(_(_(_(Fay$$eq)(y))(y$39$)))(_(_(Fay$$and)(_(_(_(Fay$$lte)(_(Fay$$sub)(_(_(_(Language$Fay$Stdlib$min)(y))(y$39$)))(_(atY))))(5)))(_(_(_(Fay$$lte)(atY))(_(_(Language$Fay$Stdlib$max)(y))(y$39$))))))))));})();}}}if (_(_($tmp1).slot1) instanceof $_Automaton$Arc) {if (Fay$$listLen(_(_(_($tmp1).slot1).slot1),2)) {var x = Fay$$index(0)(_(_(_($tmp1).slot1).slot1));var y = Fay$$index(1)(_(_(_($tmp1).slot1).slot1));return _(Fay$$and)(_(_(_(Fay$$lte)(_(Language$Fay$Stdlib$abs)(_(Fay$$sub)(_(Automaton$stateRadius))(_(_(_(Automaton$distance)(Fay$$list([x,_(Fay$$add)(_(y))(_(Automaton$stateRadius))])))(Fay$$list([atX,atY])))))))(5)))(_(_(_(Fay$$lte)(_(Fay$$add)(_(y))(_(_(Fay$$div)(_(Automaton$stateRadius))(_(_(Language$Fay$Stdlib$sqrt)(2)))))))(atY)));}}}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Automaton$getTransShape)(as))(trans));});};return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$filter)(isOn)))(_(Automaton$transs)(automaton));})();}throw ["unhandled case in getTransAt",[$p1,$p2]];});};};var Automaton$renderAutomaton = function($p1){return function($p2){return new $(function(){var rps = $p2;var cxt = $p1;return _(_(Fay$$bind)(_(Automaton$readRef)(rps)))(function($p1){var ps = $p1;return _(_(Fay$$then)(_(_(_(Automaton$clearRect)(cxt))(Fay$$list([0,0])))(Fay$$list([Automaton$canvasWidth,Automaton$canvasHeight]))))(_(_(Fay$$then)(_(_(Automaton$renderTranss)(cxt))(ps)))(_(_(Automaton$renderStates)(cxt))(ps)));});});};};var Automaton$renderStates = function($p1){return function($p2){return new $(function(){if (_($p2) instanceof $_Automaton$AutomatonState) {var mouseState = _($p2).mouseState;var automaton = _($p2).automaton;var stateMap = _($p2).stateMap;var activeState = _($p2).activeState;var cxt = $p1;return (function(){var getStates = function($p1){return new $(function(){if (Fay$$listLen(_($p1),2)) {var nid = Fay$$index(0)(_($p1));return (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {if (Fay$$listLen(_(_($tmp1).slot1),2)) {var p = Fay$$index(1)(_(_($tmp1).slot1));return _(Language$Fay$Stdlib$Just)(Fay$$list([nid,p]));}}if (_($tmp1) instanceof $_Language$Fay$Stdlib$Nothing) {return Language$Fay$Stdlib$Nothing;}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Language$Fay$Stdlib$find)(_(_(Language$Fay$Stdlib$$46$)(function($p1){var $gen_1 = $p1;return _(_(Fay$$eq)($gen_1))(nid);}))(Language$Fay$Stdlib$fst)))(stateMap));}throw ["unhandled case in getStates",[$p1]];});};return _(_(Fay$$then)(_(_(Automaton$setLineWidth)(cxt))(1)))(_(_(Fay$$then)(_(_(Automaton$setStrokeStyle)(cxt))(Fay$$list("black"))))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("black"))))(_(_(Fay$$then)(_(_(Automaton$setFont)(cxt))(Fay$$list("15pt sans-serif"))))((function(){var ns = new $(function(){return _(_(Automaton$mapMaybe)(getStates))(stateMap);});return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$forM_)(ns)))(function($p1){if (Fay$$listLen(_($p1),2)) {var state = Fay$$index(0)(_($p1));if (Fay$$listLen(_(Fay$$index(1)(_($p1))),2)) {var x = Fay$$index(0)(_(Fay$$index(1)(_($p1))));var y = Fay$$index(1)(_(Fay$$index(1)(_($p1))));return (function(){var label = new $(function(){return _(Language$Fay$Stdlib$show)(state);});return _(_(Fay$$then)(_(_(Automaton$moveTo)(cxt))(Fay$$list([x,y]))))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(Automaton$moveTo)(cxt))(Fay$$list([x,y]))))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("black"))))(_(_(Fay$$bind)(_(_(Automaton$measureText)(cxt))(label)))(function($p1){var lWidth = $p1;return _(_(Fay$$then)(_(_(_(_(Automaton$fillText)(cxt))(label))(Fay$$list([_(Fay$$sub)(_(x))(_(_(Fay$$div)(_(lWidth))(2))),_(Fay$$add)(_(y))(_(_(Fay$$div)(_(Automaton$stateRadius))(2)))])))(Language$Fay$Stdlib$Nothing)))(_(_(Fay$$then)(_(Automaton$stroke)(cxt)))((function(){var kakomi = new $(function(){return _(_(_(Fay$$eq)(state))(_(Automaton$initial)(automaton))) ? Automaton$diamond : function($p1){var cxt$39$ = $p1;return function($p2){var c = $p2;return function($p3){var r = $p3;return _(_(_(_(_(Automaton$arc)(cxt$39$))(c))(r))(0))(_(Fay$$mult)(2)(_(Language$Fay$Stdlib$pi)));};};};});return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Fay$$eq)(mouseState))(_(Automaton$StateSelected)(state)))))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(10,10,10,0.5)"))))(_(_(Fay$$then)(_(_(_(kakomi)(cxt))(Fay$$list([x,y])))(Automaton$stateRadius)))(_(Automaton$fill)(cxt)))))))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(0,0,0,0)"))))(_(_(Fay$$then)((function($tmp1){if (_($tmp1) instanceof $_Automaton$StateProgress) {var q = _($tmp1).slot1;return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Fay$$eq)(q))(state))))(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(0,255,0,0.5)")));}if (_($tmp1) instanceof $_Automaton$StateRejected) {var q = _($tmp1).slot1;return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Fay$$eq)(q))(state))))(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(255,0,0,0.5)")));}if (_($tmp1) instanceof $_Automaton$StateAccepted) {var q = _($tmp1).slot1;return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Fay$$eq)(q))(state))))(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(0,0,255,0.5)")));}return _(Fay$$$_return)(Fay$$unit);})(activeState)))(_(_(Fay$$then)(_(_(_(kakomi)(cxt))(Fay$$list([x,y])))(Automaton$stateRadius)))(_(_(Fay$$then)(_(Automaton$fill)(cxt)))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(_(kakomi)(cxt))(Fay$$list([x,y])))(Automaton$stateRadius)))(_(_(Fay$$then)(_(Automaton$stroke)(cxt)))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Language$Fay$Stdlib$elem)(state))(_(Automaton$accepts)(automaton)))))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(_(kakomi)(cxt))(Fay$$list([x,y])))(_(Fay$$mult)(_(Automaton$stateRadius))(0.8))))(_(Automaton$stroke)(cxt)))))))))))));})()));})))));})();}}throw ["unhandled case",$p1];});})()))));})();}throw ["unhandled case in renderStates",[$p1,$p2]];});};};var Automaton$renderTranss = function($p1){return function($p2){return new $(function(){var as = $p2;if (_($p2) instanceof $_Automaton$AutomatonState) {var mouseState = _($p2).mouseState;var automaton = _($p2).automaton;var cxt = $p1;return (function(){var groupTrans = new $(function(){return _(_(Language$Fay$Stdlib$$46$)(_(Automaton$groupBy)(function($p1){var a = $p1;return function($p2){var b = $p2;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(a)))(_(Automaton$transFrom)(b))))(_(_(_(Fay$$eq)(_(Automaton$transTo)(a)))(_(Automaton$transTo)(b))));};})))(_(Language$Fay$Stdlib$sortBy)(function($p1){var a = $p1;return function($p2){var b = $p2;return _(_(Language$Fay$Stdlib$compare)(Fay$$list([_(Automaton$transFrom)(a),_(Automaton$transTo)(a)])))(Fay$$list([_(Automaton$transFrom)(b),_(Automaton$transTo)(b)]));};}));});return _(_(Fay$$then)(_(_(Automaton$setLineWidth)(cxt))(Automaton$transWidth)))((function(){var ns = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(groupTrans))(_(Automaton$transs)(automaton));});return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$forM_)(ns)))(function($p1){var trans = $p1;return _(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("black"))))(_(_(Fay$$then)(_(_(Automaton$setStrokeStyle)(cxt))(Fay$$list("black"))))((function(){var colour = new $(function(){return _(_(_(Fay$$eq)(mouseState))(_(Automaton$TransSelected)(trans))) ? Fay$$list("rgba(255,0,0,0.5)") : Fay$$list("black");});return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Fay$$eq)(mouseState))(_(Automaton$TransSelected)(trans)))))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(255,0,0,0.5)"))))(_(_(Automaton$setStrokeStyle)(cxt))(Fay$$list("rgba(255,0,0,0.5)"))))))(_(_(Fay$$then)(_(_(Automaton$setFont)(cxt))(Fay$$list("10pt sans-serif"))))((function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {if (_(_($tmp1).slot1) instanceof $_Automaton$Arc) {if (Fay$$listLen(_(_(_($tmp1).slot1).slot1),2)) {var x = Fay$$index(0)(_(_(_($tmp1).slot1).slot1));var y = Fay$$index(1)(_(_(_($tmp1).slot1).slot1));return _(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(_(_(_(Automaton$arc)(cxt))(Fay$$list([x,_(Fay$$add)(_(y))(_(Automaton$stateRadius))])))(Automaton$stateRadius))(_(Fay$$div)(_(_(Fay$$mult)(5)(_(Language$Fay$Stdlib$pi))))(4)))(_(Fay$$div)(_(_(Fay$$mult)(7)(_(Language$Fay$Stdlib$pi))))(4))))(_(_(Fay$$then)(_(Automaton$stroke)(cxt)))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))((function(){var centre = new $(function(){return Fay$$list([x,_(Fay$$add)(_(_(Fay$$add)(_(y))(_(_(Fay$$mult)(3)(_(Automaton$stateRadius))))))(2)]);});return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$36$)(Automaton$arrToStr))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$intersperse)(",")))(_(_(Language$Fay$Stdlib$map)(Automaton$transAlphabet))(trans)))))(function($p1){var label = $p1;return _(_(Fay$$bind)(_(_(Automaton$measureText)(cxt))(label)))(function($p1){var lWidth = $p1;return _(_(Fay$$then)(_(_(_(_(Automaton$fillText)(cxt))(label))(_(_(Automaton$$37$$45$)(centre))(Fay$$list([_(Fay$$div)(_(lWidth))(2),0]))))(Language$Fay$Stdlib$Nothing)))(_(Automaton$fill)(cxt));});});})()))));}}if (_(_($tmp1).slot1) instanceof $_Automaton$Line) {var p0 = _(_($tmp1).slot1).slot1;var p1 = _(_($tmp1).slot1).slot2;return _(_(Fay$$then)(_(_(_(_(Automaton$arrow)(cxt))(colour))(p0))(p1)))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))((function(){var centre = new $(function(){return _(_(Automaton$$37$$42$)(0.5))(_(_(Automaton$$37$$43$)(p0))(p1));});var lPos = new $(function(){return _(_(_(Fay$$gte)(_(Language$Fay$Stdlib$fst)(p1)))(_(Language$Fay$Stdlib$fst)(p0))) ? _(_(Automaton$$37$$43$)(centre))(Fay$$list([0,_(Fay$$mult)(_(Automaton$transWidth))(7)])) : _(_(Automaton$$37$$45$)(centre))(Fay$$list([0,_(Fay$$mult)(_(Automaton$transWidth))(1)]));});return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$36$)(Automaton$arrToStr))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$intersperse)(",")))(_(_(Language$Fay$Stdlib$map)(Automaton$transAlphabet))(trans)))))(function($p1){var label = $p1;return _(_(Fay$$bind)(_(_(Automaton$measureText)(cxt))(label)))(function($p1){var lWidth = $p1;return _(_(Fay$$then)(_(_(_(_(Automaton$fillText)(cxt))(label))(_(_(Automaton$$37$$45$)(lPos))(Fay$$list([_(Fay$$div)(_(lWidth))(2),0]))))(Language$Fay$Stdlib$Nothing)))(_(Automaton$fill)(cxt));});});})()));}}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Automaton$getTransShape)(as))(_(Language$Fay$Stdlib$head)(trans)))));})()));});})());})();}var cxt = $p1;return (function(){var groupTrans = new $(function(){return _(_(Language$Fay$Stdlib$$46$)(_(Automaton$groupBy)(function($p1){var a = $p1;return function($p2){var b = $p2;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(a)))(_(Automaton$transFrom)(b))))(_(_(_(Fay$$eq)(_(Automaton$transTo)(a)))(_(Automaton$transTo)(b))));};})))(_(Language$Fay$Stdlib$sortBy)(function($p1){var a = $p1;return function($p2){var b = $p2;return _(_(Language$Fay$Stdlib$compare)(Fay$$list([_(Automaton$transFrom)(a),_(Automaton$transTo)(a)])))(Fay$$list([_(Automaton$transFrom)(b),_(Automaton$transTo)(b)]));};}));});return _(_(Fay$$then)(_(_(Automaton$setLineWidth)(cxt))(Automaton$transWidth)))((function(){var ns = new $(function(){return _(_(Language$Fay$Stdlib$$36$)(groupTrans))(_(Automaton$transs)(automaton));});return _(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$forM_)(ns)))(function($p1){var trans = $p1;return _(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("black"))))(_(_(Fay$$then)(_(_(Automaton$setStrokeStyle)(cxt))(Fay$$list("black"))))((function(){var colour = new $(function(){return _(_(_(Fay$$eq)(mouseState))(_(Automaton$TransSelected)(trans))) ? Fay$$list("rgba(255,0,0,0.5)") : Fay$$list("black");});return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$when)(_(_(Fay$$eq)(mouseState))(_(Automaton$TransSelected)(trans)))))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(Fay$$list("rgba(255,0,0,0.5)"))))(_(_(Automaton$setStrokeStyle)(cxt))(Fay$$list("rgba(255,0,0,0.5)"))))))(_(_(Fay$$then)(_(_(Automaton$setFont)(cxt))(Fay$$list("10pt sans-serif"))))((function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {if (_(_($tmp1).slot1) instanceof $_Automaton$Arc) {if (Fay$$listLen(_(_(_($tmp1).slot1).slot1),2)) {var x = Fay$$index(0)(_(_(_($tmp1).slot1).slot1));var y = Fay$$index(1)(_(_(_($tmp1).slot1).slot1));return _(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(_(_(_(Automaton$arc)(cxt))(Fay$$list([x,_(Fay$$add)(_(y))(_(Automaton$stateRadius))])))(Automaton$stateRadius))(_(Fay$$div)(_(_(Fay$$mult)(5)(_(Language$Fay$Stdlib$pi))))(4)))(_(Fay$$div)(_(_(Fay$$mult)(7)(_(Language$Fay$Stdlib$pi))))(4))))(_(_(Fay$$then)(_(Automaton$stroke)(cxt)))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))((function(){var centre = new $(function(){return Fay$$list([x,_(Fay$$add)(_(_(Fay$$add)(_(y))(_(_(Fay$$mult)(3)(_(Automaton$stateRadius))))))(2)]);});return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$36$)(Automaton$arrToStr))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$intersperse)(",")))(_(_(Language$Fay$Stdlib$map)(Automaton$transAlphabet))(trans)))))(function($p1){var label = $p1;return _(_(Fay$$bind)(_(_(Automaton$measureText)(cxt))(label)))(function($p1){var lWidth = $p1;return _(_(Fay$$then)(_(_(_(_(Automaton$fillText)(cxt))(label))(_(_(Automaton$$37$$45$)(centre))(Fay$$list([_(Fay$$div)(_(lWidth))(2),0]))))(Language$Fay$Stdlib$Nothing)))(_(Automaton$fill)(cxt));});});})()))));}}if (_(_($tmp1).slot1) instanceof $_Automaton$Line) {var p0 = _(_($tmp1).slot1).slot1;var p1 = _(_($tmp1).slot1).slot2;return _(_(Fay$$then)(_(_(_(_(Automaton$arrow)(cxt))(colour))(p0))(p1)))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))((function(){var centre = new $(function(){return _(_(Automaton$$37$$42$)(0.5))(_(_(Automaton$$37$$43$)(p0))(p1));});var lPos = new $(function(){return _(_(_(Fay$$gte)(_(Language$Fay$Stdlib$fst)(p1)))(_(Language$Fay$Stdlib$fst)(p0))) ? _(_(Automaton$$37$$43$)(centre))(Fay$$list([0,_(Fay$$mult)(_(Automaton$transWidth))(7)])) : _(_(Automaton$$37$$45$)(centre))(Fay$$list([0,_(Fay$$mult)(_(Automaton$transWidth))(1)]));});return _(_(Fay$$bind)(_(_(Language$Fay$Stdlib$$36$)(Automaton$arrToStr))(_(_(Language$Fay$Stdlib$$36$)(_(Language$Fay$Stdlib$intersperse)(",")))(_(_(Language$Fay$Stdlib$map)(Automaton$transAlphabet))(trans)))))(function($p1){var label = $p1;return _(_(Fay$$bind)(_(_(Automaton$measureText)(cxt))(label)))(function($p1){var lWidth = $p1;return _(_(Fay$$then)(_(_(_(_(Automaton$fillText)(cxt))(label))(_(_(Automaton$$37$$45$)(lPos))(Fay$$list([_(Fay$$div)(_(lWidth))(2),0]))))(Language$Fay$Stdlib$Nothing)))(_(Automaton$fill)(cxt));});});})()));}}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(_(Automaton$getTransShape)(as))(_(Language$Fay$Stdlib$head)(trans)))));})()));});})());})();throw ["unhandled case in renderTranss",[$p1,$p2]];});};};var Automaton$canvasWidth = 500;var Automaton$canvasHeight = 300;var Automaton$stateRadius = 15;var Automaton$transWidth = 2;var Automaton$distance = function($p1){return function($p2){return new $(function(){var b = $p2;var a = $p1;return _(_(Language$Fay$Stdlib$$36$)(Language$Fay$Stdlib$sqrt))(_(_(Automaton$$60$$46$$62$)(_(_(Automaton$$37$$45$)(a))(b)))(_(_(Automaton$$37$$45$)(a))(b)));});};};var $_Automaton$StateAccepted = function(slot1){this.slot1 = slot1;};var Automaton$StateAccepted = function(slot1){return new $(function(){return new $_Automaton$StateAccepted(slot1);});};var $_Automaton$StateRejected = function(slot1){this.slot1 = slot1;};var Automaton$StateRejected = function(slot1){return new $(function(){return new $_Automaton$StateRejected(slot1);});};var $_Automaton$StateProgress = function(slot1){this.slot1 = slot1;};var Automaton$StateProgress = function(slot1){return new $(function(){return new $_Automaton$StateProgress(slot1);});};var $_Automaton$NoActiveState = function(){};var Automaton$NoActiveState = new $(function(){return new $_Automaton$NoActiveState();});var $_Automaton$AutomatonState = function(automaton,stateMap,stateCount,mouseState,activeState){this.automaton = automaton;this.stateMap = stateMap;this.stateCount = stateCount;this.mouseState = mouseState;this.activeState = activeState;};var Automaton$AutomatonState = function(automaton){return function(stateMap){return function(stateCount){return function(mouseState){return function(activeState){return new $(function(){return new $_Automaton$AutomatonState(automaton,stateMap,stateCount,mouseState,activeState);});};};};};};var Automaton$automaton = function(x){return new $(function(){return _(x).automaton;});};var Automaton$stateMap = function(x){return new $(function(){return _(x).stateMap;});};var Automaton$stateCount = function(x){return new $(function(){return _(x).stateCount;});};var Automaton$mouseState = function(x){return new $(function(){return _(x).mouseState;});};var Automaton$activeState = function(x){return new $(function(){return _(x).activeState;});};var Automaton$defAutomatonState = new $(function(){var AutomatonState = new $_Automaton$AutomatonState();AutomatonState.automaton = (function(){var Automaton = new $_Automaton$Automaton();Automaton.transs = Fay$$list([_(_(_(Automaton$Trans)(0))("0"))(0),_(_(_(Automaton$Trans)(0))("1"))(1),_(_(_(Automaton$Trans)(1))("0"))(2),_(_(_(Automaton$Trans)(1))("1"))(3),_(_(_(Automaton$Trans)(2))("0"))(4),_(_(_(Automaton$Trans)(2))("a"))(5),_(_(_(Automaton$Trans)(3))("0"))(0),_(_(_(Automaton$Trans)(3))("1"))(1),_(_(_(Automaton$Trans)(4))("0"))(2),_(_(_(Automaton$Trans)(4))("1"))(3),_(_(_(Automaton$Trans)(5))("0"))(4),_(_(_(Automaton$Trans)(5))("1"))(5)]);Automaton.initial = 0;Automaton.accepts = Fay$$list([0]);return Automaton;})();AutomatonState.stateMap = Fay$$list([Fay$$list([1,Fay$$list([200,40])]),Fay$$list([2,Fay$$list([300,40])]),Fay$$list([0,Fay$$list([30,230])]),Fay$$list([3,Fay$$list([160,230])]),Fay$$list([4,Fay$$list([338,230])]),Fay$$list([5,Fay$$list([470,230])])]);AutomatonState.stateCount = 2;AutomatonState.mouseState = Automaton$Idle;AutomatonState.activeState = Automaton$NoActiveState;return AutomatonState;});var $_Automaton$Idle = function(){};var Automaton$Idle = new $(function(){return new $_Automaton$Idle();});var $_Automaton$PointAtState = function(slot1){this.slot1 = slot1;};var Automaton$PointAtState = function(slot1){return new $(function(){return new $_Automaton$PointAtState(slot1);});};var $_Automaton$DraggingState = function(slot1){this.slot1 = slot1;};var Automaton$DraggingState = function(slot1){return new $(function(){return new $_Automaton$DraggingState(slot1);});};var $_Automaton$StateSelected = function(slot1){this.slot1 = slot1;};var Automaton$StateSelected = function(slot1){return new $(function(){return new $_Automaton$StateSelected(slot1);});};var $_Automaton$TransSelected = function(slot1){this.slot1 = slot1;};var Automaton$TransSelected = function(slot1){return new $(function(){return new $_Automaton$TransSelected(slot1);});};var $_Automaton$Trans = function(transFrom,transAlphabet,transTo){this.transFrom = transFrom;this.transAlphabet = transAlphabet;this.transTo = transTo;};var Automaton$Trans = function(transFrom){return function(transAlphabet){return function(transTo){return new $(function(){return new $_Automaton$Trans(transFrom,transAlphabet,transTo);});};};};var Automaton$transFrom = function(x){return new $(function(){return _(x).transFrom;});};var Automaton$transAlphabet = function(x){return new $(function(){return _(x).transAlphabet;});};var Automaton$transTo = function(x){return new $(function(){return _(x).transTo;});};var Automaton$transEndPoints = function($p1){return new $(function(){var tr = $p1;return Fay$$list([_(Automaton$transFrom)(tr),_(Automaton$transTo)(tr)]);});};var $_Automaton$Automaton = function(transs,initial,accepts){this.transs = transs;this.initial = initial;this.accepts = accepts;};var Automaton$Automaton = function(transs){return function(initial){return function(accepts){return new $(function(){return new $_Automaton$Automaton(transs,initial,accepts);});};};};var Automaton$transs = function(x){return new $(function(){return _(x).transs;});};var Automaton$initial = function(x){return new $(function(){return _(x).initial;});};var Automaton$accepts = function(x){return new $(function(){return _(x).accepts;});};var Automaton$lookupTrans = function($p1){return function($p2){return function($p3){return new $(function(){var c = $p3;var q = $p2;if (_($p1) instanceof $_Automaton$Automaton) {var transs = _($p1).transs;return _(_(Language$Fay$Stdlib$find)(function($p1){var t = $p1;return _(Fay$$and)(_(_(_(Fay$$eq)(_(Automaton$transFrom)(t)))(q)))(_(_(_(Fay$$eq)(_(Automaton$transAlphabet)(t)))(c)));}))(transs);}throw ["unhandled case in lookupTrans",[$p1,$p2,$p3]];});};};};var Automaton$newRef = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["user","Ref",[["unknown"]]]]],new Fay$$Ref(Fay$$fayToJs(["unknown"],$p1)));});};var Automaton$writeRef = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$writeRef(Fay$$fayToJs(["user","Ref",[["unknown"]]],$p1),Fay$$fayToJs(["unknown"],$p2)));});};};var Automaton$readRef = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$readRef(Fay$$fayToJs(["user","Ref",[["unknown"]]],$p1)));});};var Automaton$arrToStr = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["string"]]],Fay$$fayToJs(["list",[["user","Char",[]]]],$p1).join(''));});};var Automaton$expose = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).show());});};var Automaton$hide = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).hide());});};var Automaton$alert = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],alert(Fay$$fayToJs(["string"],$p1)));});};var Automaton$addWindowEventListener = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],window['addEventListener'](Fay$$fayToJs(["string"],$p1),Fay$$fayToJs(["function",[["user","Event",[]],["action",[["bool"]]]]],$p2),false));});};};var Automaton$bind = function($p1){return function($p2){return function($p3){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).bind(Fay$$fayToJs(["string"],$p2), Fay$$fayToJs(["function",[["user","Event",[]],["action",[["bool"]]]]],$p3)));});};};};var Automaton$offsetX = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["double"]]],Fay$$fayToJs(["user","Event",[]],$p1)['offsetX']);});};var Automaton$offsetY = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["double"]]],Fay$$fayToJs(["user","Event",[]],$p1)['offsetY']);});};var Automaton$setInterval = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["user","Timer",[]]]],window['setInterval'](Fay$$fayToJs(["action",[["unknown"]]],$p2),Fay$$fayToJs(["double"],$p1)));});};};var Automaton$clearInterval = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],window['clearInterval'](Fay$$fayToJs(["user","Timer",[]],$p1)));});};var Automaton$getValue = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["string"]]],Fay$$fayToJs(["user","Element",[]],$p1).val());});};var Automaton$setValue = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).val(Fay$$fayToJs(["string"],$p2)));});};};var Automaton$disable = function($p1){return new $(function(){var el = $p1;return _(_(Automaton$setDisabled)(el))(true);});};var Automaton$enable = function($p1){return new $(function(){var el = $p1;return _(_(Automaton$setDisabled)(el))(false);});};var Automaton$jQuery = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["user","Element",[]]]],jQuery(Fay$$fayToJs(["string"],$p1)));});};var Automaton$setChecked = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).attr('checked', Fay$$fayToJs(["bool"],$p2)));});};};var Automaton$isChecked = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["bool"]]],Fay$$fayToJs(["user","Element",[]],$p1).attr('checked'));});};var Automaton$setAttr = function($p1){return function($p2){return function($p3){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).attr(Fay$$fayToJs(["string"],$p2), Fay$$fayToJs(["unknown"],$p3)));});};};};var Automaton$removeAttr = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).removeAttr(Fay$$fayToJs(["string"],$p2)));});};};var Automaton$setDisabled = function($p1){return function($p2){return new $(function(){if (_($p2) === true) {var el = $p1;return _(_(_(Automaton$setAttr)(el))(Fay$$list("disabled")))(Fay$$list("disabled"));}if (_($p2) === false) {var el = $p1;return _(_(Automaton$removeAttr)(el))(Fay$$list("disabled"));}throw ["unhandled case in setDisabled",[$p1,$p2]];});};};var Automaton$getIndex = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["user","Element",[]]]],Fay$$fayToJs(["user","Element",[]],$p1)[Fay$$fayToJs(["int"],$p2)]);});};};var Automaton$getContext = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["user","Context",[]]]],Fay$$fayToJs(["user","Element",[]],$p1).getContext(Fay$$fayToJs(["string"],$p2)));});};};var Automaton$setFillStyle = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['fillStyle']=Fay$$fayToJs(["string"],$p2));});};};var Automaton$setFont = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['font']=Fay$$fayToJs(["string"],$p2));});};};var Automaton$setText = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Element",[]],$p1).text(Fay$$fayToJs(["string"],$p2)));});};};var Automaton$setLineWidth = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['lineWidth']=Fay$$fayToJs(["double"],$p2));});};};var Automaton$setStrokeStyle = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['strokeStyle']=Fay$$fayToJs(["string"],$p2));});};};var Automaton$arc = function($p1){return function($p2){return function($p3){return function($p4){return function($p5){return new $(function(){var end = $p5;var beg = $p4;var r = $p3;if (Fay$$listLen(_($p2),2)) {var x = Fay$$index(0)(_($p2));var y = Fay$$index(1)(_($p2));var c = $p1;return _(_(_(_(_(_(_(Automaton$arc$39$)(c))(x))(y))(r))(beg))(end))(true);}throw ["unhandled case in arc",[$p1,$p2,$p3,$p4,$p5]];});};};};};};var Automaton$arc$39$ = function($p1){return function($p2){return function($p3){return function($p4){return function($p5){return function($p6){return function($p7){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['arc'](Fay$$fayToJs(["double"],$p2),Fay$$fayToJs(["double"],$p3),Fay$$fayToJs(["double"],$p4),Fay$$fayToJs(["double"],$p5),Fay$$fayToJs(["double"],$p6),Fay$$fayToJs(["bool"],$p7)));});};};};};};};};var Automaton$beginPath = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['beginPath']());});};var Automaton$closePath = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['closePath']());});};var Automaton$fill = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['fill']());});};var Automaton$lineTo = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x = Fay$$index(0)(_($p2));var y = Fay$$index(1)(_($p2));var c = $p1;return _(_(_(Automaton$lineTo$39$)(c))(x))(y);}throw ["unhandled case in lineTo",[$p1,$p2]];});};};var Automaton$lineTo$39$ = function($p1){return function($p2){return function($p3){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['lineTo'](Fay$$fayToJs(["double"],$p2),Fay$$fayToJs(["double"],$p3)));});};};};var Automaton$moveTo = function($p1){return function($p2){return new $(function(){if (Fay$$listLen(_($p2),2)) {var x = Fay$$index(0)(_($p2));var y = Fay$$index(1)(_($p2));var c = $p1;return _(_(_(Automaton$moveTo$39$)(c))(x))(y);}throw ["unhandled case in moveTo",[$p1,$p2]];});};};var Automaton$moveTo$39$ = function($p1){return function($p2){return function($p3){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['moveTo'](Fay$$fayToJs(["double"],$p2),Fay$$fayToJs(["double"],$p3)));});};};};var Automaton$stroke = function($p1){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['stroke']());});};var Automaton$clearRect = function($p1){return function($p2){return function($p3){return new $(function(){if (Fay$$listLen(_($p3),2)) {var w = Fay$$index(0)(_($p3));var h = Fay$$index(1)(_($p3));if (Fay$$listLen(_($p2),2)) {var x = Fay$$index(0)(_($p2));var y = Fay$$index(1)(_($p2));var c = $p1;return _(_(_(_(_(Automaton$clearRect$39$)(c))(x))(y))(w))(h);}}throw ["unhandled case in clearRect",[$p1,$p2,$p3]];});};};};var Automaton$clearRect$39$ = function($p1){return function($p2){return function($p3){return function($p4){return function($p5){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['clearRect'](Fay$$fayToJs(["double"],$p2),Fay$$fayToJs(["double"],$p3),Fay$$fayToJs(["double"],$p4),Fay$$fayToJs(["double"],$p5)));});};};};};};var Automaton$fillText = function($p1){return function($p2){return function($p3){return function($p4){return new $(function(){if (_($p4) instanceof $_Language$Fay$Stdlib$Nothing) {if (Fay$$listLen(_($p3),2)) {var x = Fay$$index(0)(_($p3));var y = Fay$$index(1)(_($p3));var s = $p2;var c = $p1;return _(_(_(_(Automaton$fillText1)(c))(s))(x))(y);}}if (_($p4) instanceof $_Language$Fay$Stdlib$Just) {var mw = _($p4).slot1;if (Fay$$listLen(_($p3),2)) {var x = Fay$$index(0)(_($p3));var y = Fay$$index(1)(_($p3));var s = $p2;var c = $p1;return _(_(_(_(_(Automaton$fillText2)(c))(s))(x))(y))(mw);}}throw ["unhandled case in fillText",[$p1,$p2,$p3,$p4]];});};};};};var Automaton$fillText1 = function($p1){return function($p2){return function($p3){return function($p4){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['fillText'](Fay$$fayToJs(["string"],$p2),Fay$$fayToJs(["double"],$p3),Fay$$fayToJs(["double"],$p4)));});};};};};var Automaton$fillText2 = function($p1){return function($p2){return function($p3){return function($p4){return function($p5){return new $(function(){return Fay$$jsToFay(["action",[["unknown"]]],Fay$$fayToJs(["user","Context",[]],$p1)['fillText'](Fay$$fayToJs(["string"],$p2),Fay$$fayToJs(["double"],$p3),Fay$$fayToJs(["double"],$p4),Fay$$fayToJs(["double"],$p5)));});};};};};};var Automaton$measureText = function($p1){return function($p2){return new $(function(){return Fay$$jsToFay(["action",[["double"]]],Fay$$fayToJs(["user","Context",[]],$p1)['measureText'](Fay$$fayToJs(["string"],$p2))['width']);});};};var Automaton$diamond = function($p1){return function($p2){return function($p3){return new $(function(){var rad = $p3;var centre = $p2;var cxt = $p1;return _(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$moveTo)(cxt)))(_(_(Automaton$$37$$45$)(centre))(Fay$$list([rad,0])))))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$lineTo)(cxt)))(_(_(Automaton$$37$$43$)(centre))(Fay$$list([0,rad])))))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$lineTo)(cxt)))(_(_(Automaton$$37$$43$)(centre))(Fay$$list([rad,0])))))(_(_(Fay$$then)(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$lineTo)(cxt)))(_(_(Automaton$$37$$45$)(centre))(Fay$$list([0,rad])))))(_(_(Language$Fay$Stdlib$$36$)(_(Automaton$lineTo)(cxt)))(_(_(Automaton$$37$$45$)(centre))(Fay$$list([rad,0])))))));});};};};var Automaton$arrow = function($p1){return function($p2){return function($p3){return function($p4){return new $(function(){if (Fay$$listLen(_($p4),2)) {var x$39$ = Fay$$index(0)(_($p4));var y$39$ = Fay$$index(1)(_($p4));if (Fay$$listLen(_($p3),2)) {var x = Fay$$index(0)(_($p3));var y = Fay$$index(1)(_($p3));var colour = $p2;var cxt = $p1;return (function(){var width = 4;var height = 8;var height$39$ = 5;var tangent = new $(function(){return _(Language$Fay$Stdlib$sqrt)(_(Fay$$add)(_(_(_(Language$Fay$Stdlib$$94$)(_(Fay$$sub)(_(x))(_(x$39$))))(2)))(_(_(_(Language$Fay$Stdlib$$94$)(_(Fay$$sub)(_(y))(_(y$39$))))(2))));});var dx = new $(function(){return _(Fay$$div)(_(_(Fay$$sub)(_(x$39$))(_(x))))(_(tangent));});var dy = new $(function(){return _(Fay$$div)(_(_(Fay$$sub)(_(y$39$))(_(y))))(_(tangent));});var left = new $(function(){return Fay$$list([_(Fay$$sub)(_(_(Fay$$sub)(_(x$39$))(_(_(Fay$$mult)(_(dy))(_(width))))))(_(_(Fay$$mult)(_(dx))(_(height)))),_(Fay$$sub)(_(_(Fay$$add)(_(y$39$))(_(_(Fay$$mult)(_(dx))(_(width))))))(_(_(Fay$$mult)(_(dy))(_(height))))]);});var right = new $(function(){return Fay$$list([_(Fay$$sub)(_(_(Fay$$add)(_(x$39$))(_(_(Fay$$mult)(_(dy))(_(width))))))(_(_(Fay$$mult)(_(dx))(_(height)))),_(Fay$$sub)(_(_(Fay$$sub)(_(y$39$))(_(_(Fay$$mult)(_(dx))(_(width))))))(_(_(Fay$$mult)(_(dy))(_(height))))]);});var middle = new $(function(){return Fay$$list([_(Fay$$sub)(_(x$39$))(_(_(Fay$$mult)(_(dx))(_(height$39$)))),_(Fay$$sub)(_(y$39$))(_(_(Fay$$mult)(_(dy))(_(height$39$))))]);});return _(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(Automaton$setStrokeStyle)(cxt))(colour)))(_(_(Fay$$then)(_(_(Automaton$moveTo)(cxt))(Fay$$list([x,y]))))(_(_(Fay$$then)(_(_(Automaton$lineTo)(cxt))(middle)))(_(_(Fay$$then)(_(Automaton$stroke)(cxt)))(_(_(Fay$$then)(_(Automaton$beginPath)(cxt)))(_(_(Fay$$then)(_(_(Automaton$setFillStyle)(cxt))(colour)))(_(_(Fay$$then)(_(_(Automaton$moveTo)(cxt))(left)))(_(_(Fay$$then)(_(_(Automaton$lineTo)(cxt))(Fay$$list([x$39$,y$39$]))))(_(_(Fay$$then)(_(_(Automaton$lineTo)(cxt))(right)))(_(_(Fay$$then)(_(_(Automaton$lineTo)(cxt))(middle)))(_(_(Fay$$then)(_(Automaton$closePath)(cxt)))(_(Automaton$fill)(cxt)))))))))))));})();}}throw ["unhandled case in arrow",[$p1,$p2,$p3,$p4]];});};};};};var Automaton$fromJust = function($p1){return new $(function(){if (_($p1) instanceof $_Language$Fay$Stdlib$Just) {var a = _($p1).slot1;return a;}throw ["unhandled case in fromJust",[$p1]];});};var Automaton$mapM = function($p1){return function($p2){return new $(function(){var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var m = $p1;return _(_(Fay$$bind)(_(m)(x)))(function($p1){var mx = $p1;return _(_(Fay$$bind)(_(_(Automaton$mapM)(m))(xs)))(function($p1){var mxs = $p1;return _(Fay$$$_return)(_(_(Fay$$cons)(mx))(mxs));});});}if (_($p2) === null) {return _(Fay$$$_return)(null);}throw ["unhandled case in mapM",[$p1,$p2]];});};};var Automaton$forM = new $(function(){return _(Language$Fay$Stdlib$flip)(Automaton$mapM);});var Automaton$mapMaybe = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var f = $p1;return (function(){var rs = new $(function(){return _(_(Automaton$mapMaybe)(f))(xs);});return (function($tmp1){if (_($tmp1) instanceof $_Language$Fay$Stdlib$Nothing) {return rs;}if (_($tmp1) instanceof $_Language$Fay$Stdlib$Just) {var r = _($tmp1).slot1;return _(_(Fay$$cons)(r))(rs);}return (function(){ throw (["unhandled case",$tmp1]); })();})(_(f)(x));})();}throw ["unhandled case in mapMaybe",[$p1,$p2]];});};};var Automaton$groupBy = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var x = $tmp1.car;var xs = $tmp1.cdr;var eq = $p1;return (function(){var ans = new $(function(){return _(_(Language$Fay$Stdlib$span)(_(eq)(x)))(xs);});var ys = new $(function(){return _(Language$Fay$Stdlib$fst)(ans);});var zs = new $(function(){return _(Language$Fay$Stdlib$snd)(ans);});return _(_(Fay$$cons)(_(_(Fay$$cons)(x))(ys)))(_(_(Automaton$groupBy)(eq))(zs));})();}throw ["unhandled case in groupBy",[$p1,$p2]];});};};var Automaton$$_delete = function($p1){return function($p2){return new $(function(){if (_($p2) === null) {return null;}var $tmp1 = _($p2);if ($tmp1 instanceof Fay$$Cons) {var y = $tmp1.car;var xs = $tmp1.cdr;var x = $p1;if (_(_(_(Fay$$eq)(x))(y))) {return xs;} else {if (true) {return _(_(Fay$$cons)(y))(_(_(Automaton$$_delete)(x))(xs));}}}throw ["unhandled case in delete",[$p1,$p2]];});};};var Automaton$$60$$61$$60$ = function($p1){return function($p2){return function($p3){return new $(function(){var a = $p3;var g = $p2;var f = $p1;return _(_(Fay$$bind)(_(g)(a)))(f);});};};};var Automaton$parseInt = function($p1){return new $(function(){return Fay$$jsToFay(["int"],parseInt(Fay$$fayToJs(["string"],$p1)));});};var Fay$$fayToJsUserDefined = function(type,obj){var _obj = _(obj);var argTypes = type[2];if (_obj instanceof $_Automaton$Automaton) {var obj_ = {"instance": "Automaton"};var obj_transs = Fay$$fayToJs(["list",[["user","Trans",[]]]],_(_obj.transs));if (undefined !== obj_transs) {obj_.transs = obj_transs;}var obj_initial = Fay$$fayToJs(["user","State",[]],_(_obj.initial));if (undefined !== obj_initial) {obj_.initial = obj_initial;}var obj_accepts = Fay$$fayToJs(["list",[["user","State",[]]]],_(_obj.accepts));if (undefined !== obj_accepts) {obj_.accepts = obj_accepts;}return obj_;}if (_obj instanceof $_Automaton$Trans) {var obj_ = {"instance": "Trans"};var obj_transFrom = Fay$$fayToJs(["user","State",[]],_(_obj.transFrom));if (undefined !== obj_transFrom) {obj_.transFrom = obj_transFrom;}var obj_transAlphabet = Fay$$fayToJs(["user","Char",[]],_(_obj.transAlphabet));if (undefined !== obj_transAlphabet) {obj_.transAlphabet = obj_transAlphabet;}var obj_transTo = Fay$$fayToJs(["user","State",[]],_(_obj.transTo));if (undefined !== obj_transTo) {obj_.transTo = obj_transTo;}return obj_;}if (_obj instanceof $_Automaton$TransSelected) {var obj_ = {"instance": "TransSelected"};var obj_slot1 = Fay$$fayToJs(["list",[["user","Trans",[]]]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$StateSelected) {var obj_ = {"instance": "StateSelected"};var obj_slot1 = Fay$$fayToJs(["user","State",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$DraggingState) {var obj_ = {"instance": "DraggingState"};var obj_slot1 = Fay$$fayToJs(["user","State",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$PointAtState) {var obj_ = {"instance": "PointAtState"};var obj_slot1 = Fay$$fayToJs(["user","State",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$Idle) {var obj_ = {"instance": "Idle"};return obj_;}if (_obj instanceof $_Automaton$AutomatonState) {var obj_ = {"instance": "AutomatonState"};var obj_automaton = Fay$$fayToJs(["user","Automaton",[]],_(_obj.automaton));if (undefined !== obj_automaton) {obj_.automaton = obj_automaton;}var obj_stateMap = Fay$$fayToJs(["list",[["tuple",[["user","State",[]],["user","Point",[]]]]]],_(_obj.stateMap));if (undefined !== obj_stateMap) {obj_.stateMap = obj_stateMap;}var obj_stateCount = Fay$$fayToJs(["int"],_(_obj.stateCount));if (undefined !== obj_stateCount) {obj_.stateCount = obj_stateCount;}var obj_mouseState = Fay$$fayToJs(["user","MouseState",[]],_(_obj.mouseState));if (undefined !== obj_mouseState) {obj_.mouseState = obj_mouseState;}var obj_activeState = Fay$$fayToJs(["user","StateKind",[]],_(_obj.activeState));if (undefined !== obj_activeState) {obj_.activeState = obj_activeState;}return obj_;}if (_obj instanceof $_Automaton$NoActiveState) {var obj_ = {"instance": "NoActiveState"};return obj_;}if (_obj instanceof $_Automaton$StateProgress) {var obj_ = {"instance": "StateProgress"};var obj_slot1 = Fay$$fayToJs(["user","State",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$StateRejected) {var obj_ = {"instance": "StateRejected"};var obj_slot1 = Fay$$fayToJs(["user","State",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$StateAccepted) {var obj_ = {"instance": "StateAccepted"};var obj_slot1 = Fay$$fayToJs(["user","State",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Automaton$Line) {var obj_ = {"instance": "Line"};var obj_slot1 = Fay$$fayToJs(["user","Point",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}var obj_slot2 = Fay$$fayToJs(["user","Point",[]],_(_obj.slot2));if (undefined !== obj_slot2) {obj_.slot2 = obj_slot2;}return obj_;}if (_obj instanceof $_Automaton$Arc) {var obj_ = {"instance": "Arc"};var obj_slot1 = Fay$$fayToJs(["user","Point",[]],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$Nothing) {var obj_ = {"instance": "Nothing"};return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$Just) {var obj_ = {"instance": "Just"};var obj_slot1 = Fay$$fayToJs(["unknown"],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$EQ) {var obj_ = {"instance": "EQ"};return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$LT) {var obj_ = {"instance": "LT"};return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$GT) {var obj_ = {"instance": "GT"};return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$Right) {var obj_ = {"instance": "Right"};var obj_slot1 = Fay$$fayToJs(["unknown"],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$Left) {var obj_ = {"instance": "Left"};var obj_slot1 = Fay$$fayToJs(["unknown"],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$Defined) {var obj_ = {"instance": "Defined"};var obj_slot1 = Fay$$fayToJs(["unknown"],_(_obj.slot1));if (undefined !== obj_slot1) {obj_.slot1 = obj_slot1;}return obj_;}if (_obj instanceof $_Language$Fay$Stdlib$Undefined) {var obj_ = {"instance": "Undefined"};return obj_;}return obj;};var Fay$$jsToFayUserDefined = function(type,obj){if (obj["instance"] === "Automaton") {return new $_Automaton$Automaton(Fay$$jsToFay(["list",[["user","Trans",[]]]],obj["transs"]),Fay$$jsToFay(["user","State",[]],obj["initial"]),Fay$$jsToFay(["list",[["user","State",[]]]],obj["accepts"]));}if (obj["instance"] === "Trans") {return new $_Automaton$Trans(Fay$$jsToFay(["user","State",[]],obj["transFrom"]),Fay$$jsToFay(["user","Char",[]],obj["transAlphabet"]),Fay$$jsToFay(["user","State",[]],obj["transTo"]));}if (obj["instance"] === "TransSelected") {return new $_Automaton$TransSelected(Fay$$jsToFay(["list",[["user","Trans",[]]]],obj["slot1"]));}if (obj["instance"] === "StateSelected") {return new $_Automaton$StateSelected(Fay$$jsToFay(["user","State",[]],obj["slot1"]));}if (obj["instance"] === "DraggingState") {return new $_Automaton$DraggingState(Fay$$jsToFay(["user","State",[]],obj["slot1"]));}if (obj["instance"] === "PointAtState") {return new $_Automaton$PointAtState(Fay$$jsToFay(["user","State",[]],obj["slot1"]));}if (obj["instance"] === "Idle") {return new $_Automaton$Idle();}if (obj["instance"] === "AutomatonState") {return new $_Automaton$AutomatonState(Fay$$jsToFay(["user","Automaton",[]],obj["automaton"]),Fay$$jsToFay(["list",[["tuple",[["user","State",[]],["user","Point",[]]]]]],obj["stateMap"]),Fay$$jsToFay(["int"],obj["stateCount"]),Fay$$jsToFay(["user","MouseState",[]],obj["mouseState"]),Fay$$jsToFay(["user","StateKind",[]],obj["activeState"]));}if (obj["instance"] === "NoActiveState") {return new $_Automaton$NoActiveState();}if (obj["instance"] === "StateProgress") {return new $_Automaton$StateProgress(Fay$$jsToFay(["user","State",[]],obj["slot1"]));}if (obj["instance"] === "StateRejected") {return new $_Automaton$StateRejected(Fay$$jsToFay(["user","State",[]],obj["slot1"]));}if (obj["instance"] === "StateAccepted") {return new $_Automaton$StateAccepted(Fay$$jsToFay(["user","State",[]],obj["slot1"]));}if (obj["instance"] === "Line") {return new $_Automaton$Line(Fay$$jsToFay(["user","Point",[]],obj["slot1"]),Fay$$jsToFay(["user","Point",[]],obj["slot2"]));}if (obj["instance"] === "Arc") {return new $_Automaton$Arc(Fay$$jsToFay(["user","Point",[]],obj["slot1"]));}if (obj["instance"] === "Nothing") {return new $_Language$Fay$Stdlib$Nothing();}if (obj["instance"] === "Just") {return new $_Language$Fay$Stdlib$Just(Fay$$jsToFay(["unknown"],obj["slot1"]));}if (obj["instance"] === "EQ") {return new $_Language$Fay$Stdlib$EQ();}if (obj["instance"] === "LT") {return new $_Language$Fay$Stdlib$LT();}if (obj["instance"] === "GT") {return new $_Language$Fay$Stdlib$GT();}if (obj["instance"] === "Right") {return new $_Language$Fay$Stdlib$Right(Fay$$jsToFay(["unknown"],obj["slot1"]));}if (obj["instance"] === "Left") {return new $_Language$Fay$Stdlib$Left(Fay$$jsToFay(["unknown"],obj["slot1"]));}if (obj["instance"] === "Defined") {return new $_Language$Fay$Stdlib$Defined(Fay$$jsToFay(["unknown"],obj["slot1"]));}if (obj["instance"] === "Undefined") {return new $_Language$Fay$Stdlib$Undefined();}return obj;};
// Exports
this.Automaton$main = Automaton$main;
this.Automaton$Automaton = Automaton$Automaton;
this.Automaton$Trans = Automaton$Trans;
this.Automaton$TransSelected = Automaton$TransSelected;
this.Automaton$StateSelected = Automaton$StateSelected;
this.Automaton$DraggingState = Automaton$DraggingState;
this.Automaton$PointAtState = Automaton$PointAtState;
this.Automaton$Idle = Automaton$Idle;
this.Automaton$AutomatonState = Automaton$AutomatonState;
this.Automaton$NoActiveState = Automaton$NoActiveState;
this.Automaton$StateProgress = Automaton$StateProgress;
this.Automaton$StateRejected = Automaton$StateRejected;
this.Automaton$StateAccepted = Automaton$StateAccepted;
this.Automaton$Line = Automaton$Line;
this.Automaton$Arc = Automaton$Arc;

// Built-ins
this._ = _;
this.$           = $;
this.$fayToJs    = Fay$$fayToJs;
this.$jsToFay    = Fay$$jsToFay;

};
;
var main = new Automaton();
main._(main.Automaton$main);

